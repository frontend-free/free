import{r as f,A as w,j as a,lK as N,a as G,S as I,B as A,cU as U,cV as J,gp as K,gq as Y,dq as $,dr as H,lA as Q,lL as X,lz as Z,a8 as ee,lM as se}from"./iframe-CfSlXzih.js";import{ax as j,ay as z,az as te,aA as ae,aB as ne,a as oe,M as re}from"./index-Sq2tbpIm.js";import{g as ie}from"./index-D5mFeJj6.js";import{s as ce}from"./index-mAKpSMLY.js";import{b as ue}from"./_baseSet-Ca75ia5T.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-Bb11UXEF.js";import"./index-DrFu-skq.js";function T(e,n,t){return e==null?e:ue(e,n,t)}function le({value:e,onCopied:n,className:t}){const[r,i]=f.useState(!1),{message:o}=w.useApp(),c=f.useCallback(async()=>{i(!0),n?.(),o.success("复制成功")},[n,o]);return a.jsx(N,{title:"复制",children:a.jsx(G,{value:e,className:I("cursor-pointer text-03",t),onCopied:c,children:a.jsx(A,{type:"text",size:"small",className:"text-03",icon:r?a.jsx(U,{}):a.jsx(J,{})})})})}function de({active:e,onClick:n,className:t}){const{message:r}=w.useApp(),[i,o]=f.useState(e||!1);f.useEffect(()=>{o(!!e)},[e]);const c=f.useCallback(async()=>{await Promise.resolve(n?.(!i)),o(!i),r.success(i?"取消点赞成功":"点赞成功")},[n,i,r]);return a.jsx(N,{title:i?"取消点赞":"点赞",children:a.jsx(A,{type:"text",onClick:c,size:"small",className:I("text-03",t),icon:i?a.jsx(K,{}):a.jsx(Y,{})})})}function me({active:e,onClick:n,className:t}){const[r,i]=f.useState(e||!1),{message:o}=w.useApp();f.useEffect(()=>{i(!!e)},[e]);const c=f.useCallback(async()=>{await Promise.resolve(n?.(!r)),i(!r),o.success(r?"取消点踩成功":"点踩成功")},[n,r,o]);return a.jsx(N,{title:r?"取消点踩":"点踩",children:a.jsx(A,{type:"text",onClick:c,size:"small",className:I("text-03",t),icon:r?a.jsx($,{}):a.jsx(H,{})})})}const _={Copy:le,Like:de,Dislike:me},fe={},F=e=>{let n;const t=new Set,r=(u,v)=>{const p=typeof u=="function"?u(n):u;if(!Object.is(p,n)){const x=n;n=v??(typeof p!="object"||p===null)?p:Object.assign({},n,p),t.forEach(s=>s(n,x))}},i=()=>n,g={setState:r,getState:i,getInitialState:()=>m,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(fe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},m=n=e(r,i,g);return g},pe=e=>e?F(e):F;var k={exports:{}},R={};var W;function ge(){if(W)return R;W=1;var e=Q(),n=X();function t(m,u){return m===u&&(m!==0||1/m===1/u)||m!==m&&u!==u}var r=typeof Object.is=="function"?Object.is:t,i=n.useSyncExternalStore,o=e.useRef,c=e.useEffect,d=e.useMemo,g=e.useDebugValue;return R.useSyncExternalStoreWithSelector=function(m,u,v,p,x){var s=o(null);if(s.current===null){var l={hasValue:!1,value:null};s.current=l}else l=s.current;s=d(function(){function b(h){if(!C){if(C=!0,E=h,h=p(h),x!==void 0&&l.hasValue){var y=l.value;if(x(y,h))return M=y}return M=h}if(y=M,r(E,h))return y;var V=p(h);return x!==void 0&&x(y,V)?(E=h,y):(E=h,M=V)}var C=!1,E,M,O=v===void 0?null:v;return[function(){return b(u())},O===null?void 0:function(){return b(O())}]},[u,v,p,x]);var S=i(m,s[0],s[1]);return c(function(){l.hasValue=!0,l.value=S},[S]),g(S),S},R}var P;function xe(){return P||(P=1,k.exports=ge()),k.exports}var he=xe();const ve=Z(he),L={},{useDebugValue:Se}=ee,{useSyncExternalStoreWithSelector:ye}=ve;let q=!1;const je=e=>e;function be(e,n=je,t){(L?"production":void 0)!=="production"&&t&&!q&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),q=!0);const r=ye(e.subscribe,e.getState,e.getServerState||e.getInitialState,n,t);return Se(r),r}const B=e=>{(L?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof e=="function"?pe(e):e,t=(r,i)=>be(n,r,i);return Object.assign(t,n),t},Ce=e=>e?B(e):B;function Ee(){const e=Ce((t,r,i)=>({contextData:void 0,setContextData:o=>{t({contextData:o})},setContextDataWithField:(o,c)=>{const d=r().contextData;t({contextData:{...d,[o]:c}})},senderValue:void 0,setSenderValue:o=>{t(()=>({senderValue:o}))},messages:[],setMessages:o=>{t(()=>({messages:o.map(c=>({createdAt:Date.now(),updatedAt:Date.now(),...c}))}))},addMessage:o=>{t(c=>({messages:[...c.messages,{...o,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:o=>{t(c=>({messages:c.messages.map(d=>d.uuid===o.uuid?{...o,updatedAt:Date.now()}:d)}))},setMessagesBefore:o=>{const c=r().messages,d=o[o.length-1],g=c.findIndex(u=>u.uuid===d.uuid),m=[...o,...c.slice(g+1)];t({messages:m})},reset:()=>{t(i.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const t=e(i=>i.messages);return{chatStatus:f.useMemo(()=>t[t.length-1]?.status,[t])}}}}const Ve={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Me(e,{onUpdate:n}){await ce(1e3);let t=0;const r=setInterval(()=>{t>50?(clearInterval(r),n({event:"done",data:""})):(n({event:"message",data:"回复"+t}),t++)},300)}function De(){const{useChatStore:e,useChatStoreComputed:n}=f.useMemo(()=>Ee(),[]),t=e(s=>s.senderValue),r=e(s=>s.setSenderValue),i=e(s=>s.messages),o=e(s=>s.setMessages),c=e(s=>s.addMessage),d=e(s=>s.updateMessage),{chatStatus:g}=n(),{message:m}=w.useApp();f.useEffect(()=>{const s=localStorage.getItem("chatMessages");s&&o(JSON.parse(s))},[]);const u=g===j.PENDING||g===j.STREAMING,v=f.useCallback(s=>{console.log("onSubmit",s);const l={uuid:z(),status:j.PENDING,user:{...s}};c(l),Me(s,{onUpdate:({event:S,data:b})=>{if(S==="message"){l.status=j.STREAMING;const C=l.ai?.data?.text||"";T(l,"ai.data.text",C+b),T(l,"ai.session_id","123"),d(l)}S==="done"&&(l.status=j.DONE,d(l))}})},[c,d]),{start:p,stop:x}=f.useMemo(()=>ie(),[]);return a.jsxs("div",{children:[a.jsx("div",{children:a.jsx(A,{onClick:()=>{c({uuid:z(),type:te.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),a.jsx("div",{className:"h-[500px] w-[500px] max-w-full border border-red-500",children:a.jsx(ae,{end:a.jsxs("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:[a.jsx("div",{children:"这里是 suggestion 区域这里是 suggestion 区域"}),a.jsx(re,{value:t,onChange:s=>r(s),loading:u,onSubmit:v,allowSpeech:{onRecordStart:async()=>{console.log("onRecordStart");try{await p({onAudio:s=>{console.log("onAudio",s)},onError:s=>{m.error(s.message)}})}catch(s){console.error(s)}},onRecordEnd:async s=>{console.log("onRecordEnd",s);const l=await x();console.log("voiceData",l)}}})]}),children:a.jsx(ne,{messages:i,renderMessageOfSystem:({message:s})=>s.system?.data?.type==="new_session"?a.jsx(se,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:s})=>a.jsx("div",{className:"p-2",children:a.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:s.user?.text})}),renderMessageOfAI:({message:s})=>a.jsxs("div",{className:"max-w-full p-2",children:[a.jsxs("div",{children:["status: ",s.status," session_id: ",s.ai?.session_id]}),a.jsx(oe,{content:s.ai?.data?.text||""}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(_.Copy,{value:s.ai?.data?.text||""}),a.jsx(_.Like,{onClick:async()=>{}}),a.jsx(_.Dislike,{onClick:async()=>{}})]})]})})})})]})}const D={render:()=>a.jsx(De,{})};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...D.parameters?.docs?.source}}};const ze=["Default"];export{D as Default,ze as __namedExportsOrder,Ve as default};
