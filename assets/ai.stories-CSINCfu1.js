import{r as f,A as w,j as n,mW as R,a as B,mu as N,B as A,e0 as U,e1 as Y,hw as $,hx as J,ex as X,ey as H,mM as K,mX as Q,mI as Z,$ as ee,M as se,mY as te}from"./iframe-BKt3d7eS.js";import{E as C,g as T,b as ae,C as ne,c as oe,M as re}from"./index-DTYxzMuB.js";import{s as ie}from"./index-mAKpSMLY.js";import{g as ce}from"./index-D5mFeJj6.js";import{b as ue}from"./_baseSet-CW7nJ2Wu.js";import"./preload-helper-PPVm8Dsz.js";function W(e,o,t){return e==null?e:ue(e,o,t)}function le({value:e,onCopied:o,className:t}){const[r,c]=f.useState(!1),{message:a}=w.useApp(),i=f.useCallback(async()=>{c(!0),o?.(),a.success("复制成功")},[o,a]);return n.jsx(R,{title:"复制",children:n.jsx(B,{value:e,className:N("cursor-pointer text-03",t),onCopied:i,children:n.jsx(A,{type:"text",size:"small",className:"text-03",icon:r?n.jsx(U,{}):n.jsx(Y,{})})})})}function de({active:e,onClick:o,className:t}){const{message:r}=w.useApp(),[c,a]=f.useState(e||!1);f.useEffect(()=>{a(!!e)},[e]);const i=f.useCallback(async()=>{await Promise.resolve(o?.(!c)),a(!c),r.success(c?"取消点赞成功":"点赞成功")},[o,c,r]);return n.jsx(R,{title:c?"取消点赞":"点赞",children:n.jsx(A,{type:"text",onClick:i,size:"small",className:N("text-03",t),icon:c?n.jsx($,{}):n.jsx(J,{})})})}function me({active:e,onClick:o,className:t}){const[r,c]=f.useState(e||!1),{message:a}=w.useApp();f.useEffect(()=>{c(!!e)},[e]);const i=f.useCallback(async()=>{await Promise.resolve(o?.(!r)),c(!r),a.success(r?"取消点踩成功":"点踩成功")},[o,r,a]);return n.jsx(R,{title:r?"取消点踩":"点踩",children:n.jsx(A,{type:"text",onClick:i,size:"small",className:N("text-03",t),icon:r?n.jsx(X,{}):n.jsx(H,{})})})}const _={Copy:le,Like:de,Dislike:me},fe={},F=e=>{let o;const t=new Set,r=(u,v)=>{const p=typeof u=="function"?u(o):u;if(!Object.is(p,o)){const x=o;o=v??(typeof p!="object"||p===null)?p:Object.assign({},o,p),t.forEach(s=>s(o,x))}},c=()=>o,g={setState:r,getState:c,getInitialState:()=>m,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(fe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},m=o=e(r,c,g);return g},ge=e=>e?F(e):F;var k={exports:{}},I={};var P;function pe(){if(P)return I;P=1;var e=K(),o=Q();function t(m,u){return m===u&&(m!==0||1/m===1/u)||m!==m&&u!==u}var r=typeof Object.is=="function"?Object.is:t,c=o.useSyncExternalStore,a=e.useRef,i=e.useEffect,d=e.useMemo,g=e.useDebugValue;return I.useSyncExternalStoreWithSelector=function(m,u,v,p,x){var s=a(null);if(s.current===null){var l={hasValue:!1,value:null};s.current=l}else l=s.current;s=d(function(){function M(h){if(!b){if(b=!0,j=h,h=p(h),x!==void 0&&l.hasValue){var y=l.value;if(x(y,h))return D=y}return D=h}if(y=D,r(j,h))return y;var V=p(h);return x!==void 0&&x(y,V)?(j=h,y):(j=h,D=V)}var b=!1,j,D,O=v===void 0?null:v;return[function(){return M(u())},O===null?void 0:function(){return M(O())}]},[u,v,p,x]);var S=c(m,s[0],s[1]);return i(function(){l.hasValue=!0,l.value=S},[S]),g(S),S},I}var z;function xe(){return z||(z=1,k.exports=pe()),k.exports}var he=xe();const ve=Z(he),q={},{useDebugValue:Se}=ee,{useSyncExternalStoreWithSelector:ye}=ve;let G=!1;const Ce=e=>e;function Me(e,o=Ce,t){(q?"production":void 0)!=="production"&&t&&!G&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),G=!0);const r=ye(e.subscribe,e.getState,e.getServerState||e.getInitialState,o,t);return Se(r),r}const L=e=>{(q?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof e=="function"?ge(e):e,t=(r,c)=>Me(o,r,c);return Object.assign(t,o),t},be=e=>e?L(e):L;function je(){const e=be((t,r,c)=>({senderValue:void 0,setSenderValue:a=>{t(()=>({senderValue:a}))},messages:[],setMessages:a=>{t(()=>({messages:a.map(i=>({createdAt:Date.now(),updatedAt:Date.now(),...i}))}))},addMessage:a=>{t(i=>({messages:[...i.messages,{...a,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:a=>{t(i=>({messages:i.messages.map(d=>d.uuid===a.uuid?{...a,updatedAt:Date.now()}:d)}))},setMessagesBefore:a=>{if(a.length===0)return;const i=r().messages,d=a[a.length-1],g=i.findIndex(u=>u.uuid===d.uuid),m=[...a,...i.slice(g+1)];t({messages:m})},setMessagesAfter:a=>{if(a.length===0)return;const i=r().messages,d=a[0],g=i.findIndex(u=>u.uuid===d.uuid),m=[...i.slice(0,g),...a];t({messages:m})},contextData:void 0,setContextData:a=>{t({contextData:a})},setContextDataWithField:(a,i)=>{const d=r().contextData;t({contextData:{...d,[a]:i}})},setContextDataPartial:a=>{const i=r().contextData;t({contextData:{...i,...a}})},reset:()=>{t(c.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const t=e(c=>c.messages);return{chatStatus:f.useMemo(()=>t[t.length-1]?.status,[t])}}}}const Ne={title:"@fe-free/ai/Example",tags:["autodocs"]};async function De(e,{onUpdate:o}){await ie(1e3);let t=0;const r=setInterval(()=>{t>50?(clearInterval(r),o({event:"done",data:""})):(o({event:"message",data:"回复"+t}),t++)},300)}function Ee(){const{useChatStore:e,useChatStoreComputed:o}=f.useMemo(()=>je(),[]),t=e(s=>s.senderValue),r=e(s=>s.setSenderValue),c=e(s=>s.messages),a=e(s=>s.setMessages),i=e(s=>s.addMessage),d=e(s=>s.updateMessage),{chatStatus:g}=o(),{message:m}=w.useApp();f.useEffect(()=>{const s=localStorage.getItem("chatMessages");s&&a(JSON.parse(s))},[]);const u=g===C.PENDING||g===C.STREAMING,v=f.useCallback(s=>{console.log("onSubmit",s);const l={uuid:T(),status:C.PENDING,user:{...s}};i(l),De(s,{onUpdate:({event:S,data:M})=>{if(S==="message"){l.status=C.STREAMING;const b=l.ai?.data?.text||"";W(l,"ai.data.text",b+M),W(l,"ai.session_id","123"),d(l)}S==="done"&&(l.status=C.DONE,d(l))}})},[i,d]),{start:p,stop:x}=f.useMemo(()=>ce(),[]);return n.jsxs("div",{children:[n.jsx("div",{children:n.jsx(A,{onClick:()=>{i({uuid:T(),type:ae.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),n.jsx("div",{className:"h-[500px] w-[500px] max-w-full border border-red-500",children:n.jsx(ne,{end:n.jsxs("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:[n.jsx("div",{children:"这里是 suggestion 区域这里是 suggestion 区域"}),n.jsx(re,{value:t,onChange:s=>r(s),loading:u,onSubmit:v,allowSpeech:{onRecordStart:async()=>{console.log("onRecordStart");try{await p({onAudio:s=>{console.log("onAudio",s)},onError:s=>{m.error(s.message)}})}catch(s){console.error(s)}},onRecordEnd:async s=>{console.log("onRecordEnd",s);const l=await x();console.log("voiceData",l)}}})]}),children:n.jsx(oe,{messages:c,renderMessageOfSystem:({message:s})=>s.system?.data?.type==="new_session"?n.jsx(te,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:s})=>n.jsx("div",{className:"p-2",children:n.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:s.user?.text})}),renderMessageOfAI:({message:s})=>n.jsxs("div",{className:"max-w-full p-2",children:[n.jsxs("div",{children:["status: ",s.status," session_id: ",s.ai?.session_id]}),n.jsx(se,{content:s.ai?.data?.text||""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(_.Copy,{value:s.ai?.data?.text||""}),n.jsx(_.Like,{onClick:async()=>{}}),n.jsx(_.Dislike,{onClick:async()=>{}})]})]})})})})]})}const E={render:()=>n.jsx(Ee,{})};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...E.parameters?.docs?.source}}};const Oe=["Default"];export{E as Default,Oe as __namedExportsOrder,Ne as default};
