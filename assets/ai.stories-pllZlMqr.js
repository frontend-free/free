import{lh as R,li as L,lj as q,lk as U,ll as $,r as x,lm as J,j as n,ln as A,a as K,B as M,cu as Y,cv as H,f$ as Q,g0 as X,c$ as Z,d0 as ee,l6 as te,lo as se,l8 as ae,a2 as ne,lp as re}from"./iframe-WTJCbJIS.js";import{E as y,g as T,b as oe,C as ie,c as ue,M as ce}from"./index-CmoXAuiX.js";import{s as le}from"./index-mAKpSMLY.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-D8O7Xzrd.js";function de(e,t,s,r){if(!R(e))return e;t=L(t,e);for(var o=-1,i=t.length,m=i-1,d=e;d!=null&&++o<i;){var f=q(t[o]),l=s;if(f==="__proto__"||f==="constructor"||f==="prototype")return e;if(o!=m){var u=d[f];l=void 0,l===void 0&&(l=R(u)?u:U(t[o+1])?[]:{})}$(d,f,l),d=d[f]}return e}function z(e,t,s){return e==null?e:de(e,t,s)}function fe({value:e,onCopied:t}){const[s,r]=x.useState(!1),{message:o}=J.useApp(),i=x.useCallback(async()=>{r(!0),t?.(),o.success("复制成功")},[t,o]);return n.jsx(A,{title:"复制",children:n.jsx(K,{value:e,className:"cursor-pointer text-03",onCopied:i,children:n.jsx(M,{type:"text",size:"small",className:"text-03",icon:s?n.jsx(Y,{}):n.jsx(H,{})})})})}function me({onClick:e}){const[t,s]=x.useState(!1),r=x.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return n.jsx(A,{title:t?"取消点赞":"点赞",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:t?n.jsx(Q,{}):n.jsx(X,{})})})}function pe({onClick:e}){const[t,s]=x.useState(!1),r=x.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return n.jsx(A,{title:t?"取消点踩":"点踩",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:t?n.jsx(Z,{}):n.jsx(ee,{})})})}const D={Copy:fe,Like:me,Dislike:pe},ge={},F=e=>{let t;const s=new Set,r=(u,a)=>{const c=typeof u=="function"?u(t):u;if(!Object.is(c,t)){const p=t;t=a??(typeof c!="object"||c===null)?c:Object.assign({},t,c),s.forEach(g=>g(t,p))}},o=()=>t,f={setState:r,getState:o,getInitialState:()=>l,subscribe:u=>(s.add(u),()=>s.delete(u)),destroy:()=>{(ge?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},l=t=e(r,o,f);return f},xe=e=>e?F(e):F;var _={exports:{}},w={};var P;function ve(){if(P)return w;P=1;var e=te(),t=se();function s(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:s,o=t.useSyncExternalStore,i=e.useRef,m=e.useEffect,d=e.useMemo,f=e.useDebugValue;return w.useSyncExternalStoreWithSelector=function(l,u,a,c,p){var g=i(null);if(g.current===null){var h={hasValue:!1,value:null};g.current=h}else h=g.current;g=d(function(){function I(v){if(!N){if(N=!0,j=v,v=c(v),p!==void 0&&h.hasValue){var S=h.value;if(p(S,v))return b=S}return b=v}if(S=b,r(j,v))return S;var k=c(v);return p!==void 0&&p(S,k)?(j=v,S):(j=v,b=k)}var N=!1,j,b,O=a===void 0?null:a;return[function(){return I(u())},O===null?void 0:function(){return I(O())}]},[u,a,c,p]);var C=o(l,g[0],g[1]);return m(function(){h.hasValue=!0,h.value=C},[C]),f(C),C},w}var V;function he(){return V||(V=1,_.exports=ve()),_.exports}var Se=he();const ye=ae(Se),G={},{useDebugValue:Ce}=ne,{useSyncExternalStoreWithSelector:je}=ye;let W=!1;const be=e=>e;function Ee(e,t=be,s){(G?"production":void 0)!=="production"&&s&&!W&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),W=!0);const r=je(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return Ce(r),r}const B=e=>{(G?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?xe(e):e,s=(r,o)=>Ee(t,r,o);return Object.assign(s,t),s},Me=e=>e?B(e):B;function De(){const e=Me((s,r,o)=>({senderValue:void 0,setSenderValue:i=>{s(()=>({senderValue:i}))},messages:[],setMessages:i=>{s(()=>({messages:i.map(m=>({createdAt:Date.now(),updatedAt:Date.now(),...m}))}))},addMessage:i=>{s(m=>({messages:[...m.messages,{...i,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:i=>{s(m=>({messages:m.messages.map(d=>d.uuid===i.uuid?{...i,updatedAt:Date.now()}:d)}))},contextData:void 0,setContextData:i=>{s(()=>({contextData:i}))},reset:()=>{s(o.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const s=e(o=>o.messages);return{chatStatus:x.useMemo(()=>s[s.length-1]?.status,[s])}}}}const Re={title:"@fe-free/ai/Example",tags:["autodocs"]};async function _e(e,{onUpdate:t}){await le(1e3);let s=0;const r=setInterval(()=>{s>50?(clearInterval(r),t({event:"done",data:""})):(t({event:"message",data:"回复"+s}),s++)},300)}function we(){const{useChatStore:e,useChatStoreComputed:t}=x.useMemo(()=>De(),[]),s=e(a=>a.senderValue),r=e(a=>a.setSenderValue),o=e(a=>a.messages),i=e(a=>a.setMessages),m=e(a=>a.addMessage),d=e(a=>a.updateMessage),{chatStatus:f}=t();x.useEffect(()=>{const a=localStorage.getItem("chatMessages");a&&i(JSON.parse(a))},[]);const l=f===y.PENDING||f===y.STREAMING,u=x.useCallback(a=>{console.log("onSubmit",a);const c={uuid:T(),status:y.PENDING,user:{...a}};m(c),_e(a,{onUpdate:({event:p,data:g})=>{if(p==="message"){c.status=y.STREAMING;const h=c.ai?.data?.text||"";z(c,"ai.data.text",h+g),z(c,"ai.session_id","123"),d(c)}p==="done"&&(c.status=y.DONE,d(c))}})},[]);return n.jsxs("div",{children:[n.jsx("div",{children:n.jsx(M,{onClick:()=>{m({uuid:T(),type:oe.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),n.jsx("div",{className:"h-[800px] w-[500px] border border-red-500",children:n.jsx(ie,{end:n.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:n.jsx(ce,{value:s,onChange:a=>r(a),loading:l,onSubmit:u})}),children:n.jsx(ue,{messages:o,renderMessageOfSystem:({message:a})=>a.system?.data?.type==="new_session"?n.jsx(re,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:a})=>n.jsx("div",{className:"p-2",children:n.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:a.user?.text})}),renderMessageOfAI:({message:a})=>n.jsxs("div",{className:"p-2",children:[n.jsxs("div",{children:["status: ",a.status," session_id: ",a.ai?.session_id]}),n.jsx("pre",{className:"whitespace-pre-wrap",children:a.ai?.data?.text}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(D.Copy,{value:a.ai?.data?.text||""}),n.jsx(D.Like,{onClick:async()=>{}}),n.jsx(D.Dislike,{onClick:async()=>{}})]})]})})})})]})}const E={render:()=>n.jsx(we,{})};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...E.parameters?.docs?.source}}};const Te=["Default"];export{E as Default,Te as __namedExportsOrder,Re as default};
