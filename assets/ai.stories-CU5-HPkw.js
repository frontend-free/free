import{r as l,A as w,j as o,lK as N,a as L,B as A,cU as G,cV as U,gp as J,gq as K,dq as Y,dr as $,lA as H,lL as Q,lz as X,a8 as Z,lM as ee}from"./iframe-D-jB6qCX.js";import{ax as b,ay as V,az as te,aA as se,aB as ae,a as oe,M as ne}from"./index-DmjRZCEj.js";import{g as re}from"./index-D5mFeJj6.js";import{s as ie}from"./index-mAKpSMLY.js";import{b as ce}from"./_baseSet-C0RbQApk.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-CVcV1uw3.js";import"./index-DrFu-skq.js";function z(e,a,s){return e==null?e:ce(e,a,s)}function ue({value:e,onCopied:a}){const[s,n]=l.useState(!1),{message:r}=w.useApp(),i=l.useCallback(async()=>{n(!0),a?.(),r.success("复制成功")},[a,r]);return o.jsx(N,{title:"复制",children:o.jsx(L,{value:e,className:"cursor-pointer text-03",onCopied:i,children:o.jsx(A,{type:"text",size:"small",className:"text-03",icon:s?o.jsx(G,{}):o.jsx(U,{})})})})}function le({active:e,onClick:a}){const{message:s}=w.useApp(),[n,r]=l.useState(e||!1);l.useEffect(()=>{r(!!e)},[e]);const i=l.useCallback(async()=>{await Promise.resolve(a?.(!n)),r(!n),s.success(n?"取消点赞成功":"点赞成功")},[a,n,s]);return o.jsx(N,{title:n?"取消点赞":"点赞",children:o.jsx(A,{type:"text",onClick:i,size:"small",className:"text-03",icon:n?o.jsx(J,{}):o.jsx(K,{})})})}function de({active:e,onClick:a}){const[s,n]=l.useState(e||!1),{message:r}=w.useApp();l.useEffect(()=>{n(!!e)},[e]);const i=l.useCallback(async()=>{await Promise.resolve(a?.(!s)),n(!s),r.success(s?"取消点踩成功":"点踩成功")},[a,s,r]);return o.jsx(N,{title:s?"取消点踩":"点踩",children:o.jsx(A,{type:"text",onClick:i,size:"small",className:"text-03",icon:s?o.jsx(Y,{}):o.jsx($,{})})})}const _={Copy:ue,Like:le,Dislike:de},me={},T=e=>{let a;const s=new Set,n=(u,h)=>{const f=typeof u=="function"?u(a):u;if(!Object.is(f,a)){const g=a;a=h??(typeof f!="object"||f===null)?f:Object.assign({},a,f),s.forEach(t=>t(a,g))}},r=()=>a,v={setState:n,getState:r,getInitialState:()=>m,subscribe:u=>(s.add(u),()=>s.delete(u)),destroy:()=>{(me?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},m=a=e(n,r,v);return v},fe=e=>e?T(e):T;var k={exports:{}},R={};var F;function pe(){if(F)return R;F=1;var e=H(),a=Q();function s(m,u){return m===u&&(m!==0||1/m===1/u)||m!==m&&u!==u}var n=typeof Object.is=="function"?Object.is:s,r=a.useSyncExternalStore,i=e.useRef,d=e.useEffect,p=e.useMemo,v=e.useDebugValue;return R.useSyncExternalStoreWithSelector=function(m,u,h,f,g){var t=i(null);if(t.current===null){var c={hasValue:!1,value:null};t.current=c}else c=t.current;t=p(function(){function j(x){if(!E){if(E=!0,C=x,x=f(x),g!==void 0&&c.hasValue){var y=c.value;if(g(y,x))return M=y}return M=x}if(y=M,n(C,x))return y;var O=f(x);return g!==void 0&&g(y,O)?(C=x,y):(C=x,M=O)}var E=!1,C,M,I=h===void 0?null:h;return[function(){return j(u())},I===null?void 0:function(){return j(I())}]},[u,h,f,g]);var S=r(m,t[0],t[1]);return d(function(){c.hasValue=!0,c.value=S},[S]),v(S),S},R}var P;function ge(){return P||(P=1,k.exports=pe()),k.exports}var xe=ge();const he=X(xe),B={},{useDebugValue:ve}=Z,{useSyncExternalStoreWithSelector:Se}=he;let W=!1;const ye=e=>e;function be(e,a=ye,s){(B?"production":void 0)!=="production"&&s&&!W&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),W=!0);const n=Se(e.subscribe,e.getState,e.getServerState||e.getInitialState,a,s);return ve(n),n}const q=e=>{(B?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof e=="function"?fe(e):e,s=(n,r)=>be(a,n,r);return Object.assign(s,a),s},je=e=>e?q(e):q;function Ee(){const e=je((s,n,r)=>({senderValue:void 0,setSenderValue:i=>{s(()=>({senderValue:i}))},messages:[],setMessages:i=>{s(()=>({messages:i.map(d=>({createdAt:Date.now(),updatedAt:Date.now(),...d}))}))},addMessage:i=>{s(d=>({messages:[...d.messages,{...i,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:i=>{s(d=>({messages:d.messages.map(p=>p.uuid===i.uuid?{...i,updatedAt:Date.now()}:p)}))},contextData:void 0,setContextData:i=>{s(()=>({contextData:i}))},reset:()=>{s(r.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const s=e(r=>r.messages);return{chatStatus:l.useMemo(()=>s[s.length-1]?.status,[s])}}}}const Oe={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Ce(e,{onUpdate:a}){await ie(1e3);let s=0;const n=setInterval(()=>{s>50?(clearInterval(n),a({event:"done",data:""})):(a({event:"message",data:"回复"+s}),s++)},300)}function Me(){const{useChatStore:e,useChatStoreComputed:a}=l.useMemo(()=>Ee(),[]),s=e(t=>t.senderValue),n=e(t=>t.setSenderValue),r=e(t=>t.messages),i=e(t=>t.setMessages),d=e(t=>t.addMessage),p=e(t=>t.updateMessage),{chatStatus:v}=a(),{message:m}=w.useApp();l.useEffect(()=>{const t=localStorage.getItem("chatMessages");t&&i(JSON.parse(t))},[]);const u=v===b.PENDING||v===b.STREAMING,h=l.useCallback(t=>{console.log("onSubmit",t);const c={uuid:V(),status:b.PENDING,user:{...t}};d(c),Ce(t,{onUpdate:({event:S,data:j})=>{if(S==="message"){c.status=b.STREAMING;const E=c.ai?.data?.text||"";z(c,"ai.data.text",E+j),z(c,"ai.session_id","123"),p(c)}S==="done"&&(c.status=b.DONE,p(c))}})},[d,p]),{start:f,stop:g}=l.useMemo(()=>re(),[]);return o.jsxs("div",{children:[o.jsx("div",{children:o.jsx(A,{onClick:()=>{d({uuid:V(),type:te.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),o.jsx("div",{className:"h-[800px] w-[500px] max-w-full border border-red-500",children:o.jsx(se,{end:o.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:o.jsx(ne,{value:s,onChange:t=>n(t),loading:u,onSubmit:h,allowSpeech:{onRecordStart:async()=>{console.log("onRecordStart");try{await f({onAudio:t=>{console.log("onAudio",t)},onError:t=>{m.error(t.message)}})}catch(t){console.error(t)}},onRecordEnd:async t=>{console.log("onRecordEnd",t);const c=await g();console.log("voiceData",c)}}})}),children:o.jsx(ae,{messages:r,renderMessageOfSystem:({message:t})=>t.system?.data?.type==="new_session"?o.jsx(ee,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:t})=>o.jsx("div",{className:"p-2",children:o.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:t.user?.text})}),renderMessageOfAI:({message:t})=>o.jsxs("div",{className:"max-w-full p-2",children:[o.jsxs("div",{children:["status: ",t.status," session_id: ",t.ai?.session_id]}),o.jsx(oe,{content:t.ai?.data?.text||""}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(_.Copy,{value:t.ai?.data?.text||""}),o.jsx(_.Like,{onClick:async()=>{}}),o.jsx(_.Dislike,{onClick:async()=>{}})]})]})})})})]})}const D={render:()=>o.jsx(Me,{})};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...D.parameters?.docs?.source}}};const Ve=["Default"];export{D as Default,Ve as __namedExportsOrder,Oe as default};
