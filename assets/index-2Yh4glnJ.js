import{lq as G,r as d,lr as W,ls as Q,j as n,z as D,F as U,lt as J,d as K,X as S,B as b,lu as j,lv as L,lm as E,lw as X,bZ as F,lx as ee,hl as ne,g4 as re,ly as te,aO as ae,lp as ie}from"./iframe-mp9Ful1e.js";import{I as C}from"./Icon-BXoEkJbz.js";var se=function(e,r){r===void 0&&(r={});var t=G(r),a=d.useRef(void 0);W(function(){var i=Q(e);if(i?.addEventListener){var o=function(l,u){var c=l.getData("text/uri-list"),m=l.getData("custom");if(m&&t.current.onDom){var h=m;try{h=JSON.parse(m)}catch{h=m}t.current.onDom(h,u);return}if(c&&t.current.onUri){t.current.onUri(c,u);return}if(l.files&&l.files.length&&t.current.onFiles){t.current.onFiles(Array.from(l.files),u);return}l.items&&l.items.length&&t.current.onText&&l.items[0].getAsString(function(w){t.current.onText(w,u)})},g=function(l){var u,c;l.preventDefault(),l.stopPropagation(),a.current=l.target,(c=(u=t.current).onDragEnter)===null||c===void 0||c.call(u,l)},p=function(l){var u,c;l.preventDefault(),(c=(u=t.current).onDragOver)===null||c===void 0||c.call(u,l)},s=function(l){var u,c;l.target===a.current&&((c=(u=t.current).onDragLeave)===null||c===void 0||c.call(u,l))},v=function(l){var u,c;l.preventDefault(),o(l.dataTransfer,l),(c=(u=t.current).onDrop)===null||c===void 0||c.call(u,l)},f=function(l){var u,c;o(l.clipboardData,l),(c=(u=t.current).onPaste)===null||c===void 0||c.call(u,l)};return i.addEventListener("dragenter",g),i.addEventListener("dragover",p),i.addEventListener("dragleave",s),i.addEventListener("drop",v),i.addEventListener("paste",f),function(){i.removeEventListener("dragenter",g),i.removeEventListener("dragover",p),i.removeEventListener("dragleave",s),i.removeEventListener("drop",v),i.removeEventListener("paste",f)}}},[],e)};function oe({end:e,endClassName:r,children:t,childrenClassName:a}){return n.jsx(D,{direction:"vertical",end:e,endClassName:r,childrenClassName:a,children:t})}oe.__docgenInfo={description:"",methods:[],displayName:"Chat",props:{end:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},endClassName:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},childrenClassName:{required:!1,tsType:{name:"string"},description:""}}};function le(e){return e.startsWith("http")||e.startsWith("https")}function q({url:e,isImage:r}){const t=r??U.isImage(e),a=le(e)?decodeURIComponent(e):e,i=a.split("/").pop()||a;return n.jsx("div",{className:"fea-file-view",children:t?n.jsx(J,{width:60,height:60,src:e}):n.jsx("div",{className:"flex h-[60px] w-[250px] items-center rounded bg-01 px-1",children:n.jsx("div",{className:"min-w-0",children:n.jsx(U,{name:i})})})})}function de({urls:e}){return n.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(r=>n.jsx(q,{url:r},r))})}q.__docgenInfo={description:"",methods:[],displayName:"FileView",props:{url:{required:!0,tsType:{name:"string"},description:""},isImage:{required:!1,tsType:{name:"boolean"},description:""}}};de.__docgenInfo={description:"",methods:[],displayName:"FileViewList",props:{urls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""}}};const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));function ue(e,r=0){return(y[e[r+0]]+y[e[r+1]]+y[e[r+2]]+y[e[r+3]]+"-"+y[e[r+4]]+y[e[r+5]]+"-"+y[e[r+6]]+y[e[r+7]]+"-"+y[e[r+8]]+y[e[r+9]]+"-"+y[e[r+10]]+y[e[r+11]]+y[e[r+12]]+y[e[r+13]]+y[e[r+14]]+y[e[r+15]]).toLowerCase()}let M;const ce=new Uint8Array(16);function me(){if(!M){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");M=crypto.getRandomValues.bind(crypto)}return M(ce)}const pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),A={randomUUID:pe};function ge(e,r,t){e=e||{};const a=e.random??e.rng?.()??me();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,ue(a)}function fe(e,r,t){return A.randomUUID&&!e?A.randomUUID():ge(e)}function ve(e){const r=[.1,.2,.4,.6,.8,.9];return r[e%r.length]}function V({count:e=4,gap:r=2,color:t="white"}){return n.jsx("div",{className:"flex h-0 gap-[2px]",style:{gap:`${r}px`},children:K(e).map(a=>n.jsx("div",{className:S({"bg-white":t==="white","bg-primary":t==="primary"}),style:{height:"4px",width:"2px",animation:`sender-rectangle-${t} infinite 1s ease-in-out ${ve(a)}s`}},a))})}function Ve(){return fe()}V.__docgenInfo={description:"",methods:[],displayName:"RecordLoading",props:{count:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"4",computed:!1}},height:{required:!1,tsType:{name:"number"},description:""},width:{required:!1,tsType:{name:"number"},description:""},gap:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"2",computed:!1}},color:{required:!1,tsType:{name:"union",raw:"'white' | 'primary'",elements:[{name:"literal",value:"'white'"},{name:"literal",value:"'primary'"}]},description:"",defaultValue:{value:"'white'",computed:!1}}}};const ye=e=>d.createElement("svg",{width:14,height:18,viewBox:"0 0 14 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M1.46387 8.41895C1.46399 11.2488 3.75802 13.5429 6.58789 13.543C9.41782 13.543 11.7118 11.2488 11.7119 8.41895H13.1758C13.1757 11.8102 10.6136 14.6009 7.31934 14.9648V17.2031H5.85547V14.9648C2.56181 14.6004 0.000112876 11.8097 0 8.41895H1.46387ZM6.58789 0C8.60932 0 10.248 1.63873 10.248 3.66016V8.41797C10.248 10.4394 8.60932 12.0781 6.58789 12.0781C4.56664 12.0779 2.92773 10.4393 2.92773 8.41797V3.66016C2.92775 1.63887 4.56665 0.000220666 6.58789 0Z"})),P=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"size-18 text-dbx-static-white",...e},d.createElement("path",{d:"M10.6254 20.3752V6.69549L5.47304 11.8478C4.93607 12.3848 4.0647 12.3848 3.52773 11.8478C2.99076 11.3109 2.99076 10.4395 3.52773 9.90252L11.0277 2.40252L11.1322 2.30877C11.6723 1.86801 12.4695 1.89901 12.973 2.40252L20.473 9.90252L20.5668 10.007C21.0075 10.5471 20.9766 11.3443 20.473 11.8478C19.9695 12.3513 19.1723 12.3823 18.6322 11.9416L18.5277 11.8478L13.3754 6.69549V20.3752C13.3754 21.1346 12.7598 21.7502 12.0004 21.7502C11.241 21.7502 10.6254 21.1346 10.6254 20.3752Z",fill:"currentColor"}));function I(e){const{refText:r,loading:t,onSubmit:a,value:i,onChange:o,setType:g,allowSpeech:p}=e,s=t,v=d.useCallback(async()=>{if(s||i?.text?.trim()==="")return;const f={...i,text:i?.text?.trim()};(f.text||f.files&&f.files.length>0)&&(await Promise.resolve(a?.(f)),o?.({}),r.current?.focus())},[s,i,a,o,r]);return n.jsx("div",{className:"mr-1 flex items-center gap-2",children:p&&!i?.text?n.jsx(b,{type:"primary",shape:"circle",icon:n.jsx(C,{component:ye}),onClick:()=>g("record")}):n.jsx(b,{type:"primary",shape:"circle",icon:n.jsx(C,{component:P}),loading:s,onClick:v})})}I.__docgenInfo={description:"",methods:[],displayName:"Actions",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""},refText:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLTextAreaElement"}],raw:"RefObject<HTMLTextAreaElement>"},description:""},type:{required:!0,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},setType:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: 'input' | 'record') => void",signature:{arguments:[{type:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},name:"type"}],return:{name:"void"}}},description:""}}};const he=e=>d.createElement("svg",{width:20,height:18,viewBox:"0 0 20 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M14.9561 0C15.6719 -6.75109e-08 16.2617 -0.000981836 16.7402 0.0380859C17.2288 0.0780087 17.6787 0.164078 18.1006 0.378906C18.7546 0.712247 19.2867 1.24447 19.6201 1.89844C19.8351 2.32031 19.921 2.77023 19.9609 3.25879C20 3.7373 19.999 4.32705 19.999 5.04297V12.3477C19.999 13.0634 20 13.6534 19.9609 14.1318C19.921 14.6203 19.8349 15.0694 19.6201 15.4912C19.2867 16.1456 18.7549 16.6782 18.1006 17.0117C17.6786 17.2267 17.2289 17.3126 16.7402 17.3525C16.2617 17.3916 15.672 17.3906 14.9561 17.3906H5.04297C4.32702 17.3906 3.73732 17.3916 3.25879 17.3525C2.77019 17.3126 2.32034 17.2267 1.89844 17.0117C1.24428 16.6782 0.712259 16.1455 0.378906 15.4912C0.1642 15.0695 0.078011 14.6202 0.0380859 14.1318C-0.000970309 13.6534 -2.36304e-07 13.0634 0 12.3477V5.04297C-4.75188e-07 4.32705 -0.00100976 3.7373 0.0380859 3.25879C0.0780378 2.7702 0.163945 2.32032 0.378906 1.89844C0.712319 1.24436 1.24435 0.712298 1.89844 0.378906C2.32035 0.163931 2.77017 0.0780345 3.25879 0.0380859C3.73732 -0.00101134 4.32702 -3.93286e-07 5.04297 0H14.9561ZM5.04297 1.73828C4.29836 1.73828 3.79169 1.73951 3.40039 1.77148C3.01944 1.80264 2.82442 1.85944 2.68848 1.92871C2.36139 2.09541 2.09543 2.3614 1.92871 2.68848C1.85945 2.82441 1.80264 3.0195 1.77148 3.40039C1.73951 3.79168 1.73828 4.29841 1.73828 5.04297V12.3477C1.73828 13.092 1.73955 13.599 1.77148 13.9902C1.8026 14.3707 1.85956 14.5662 1.92871 14.7021C2.09537 15.0291 2.36157 15.2952 2.68848 15.4619C2.82441 15.5312 3.01958 15.588 3.40039 15.6191C3.79169 15.6511 4.29836 15.6514 5.04297 15.6514H14.9561C15.7006 15.6514 16.2073 15.6511 16.5986 15.6191C16.9796 15.588 17.1746 15.5312 17.3105 15.4619C17.6377 15.2952 17.9036 15.0293 18.0703 14.7021C18.1395 14.5662 18.1964 14.371 18.2275 13.9902C18.2595 13.599 18.2607 13.092 18.2607 12.3477V5.04297C18.2607 4.29841 18.2595 3.79168 18.2275 3.40039C18.1964 3.01955 18.1396 2.82441 18.0703 2.68848C17.9036 2.36151 17.6376 2.09536 17.3105 1.92871C17.1746 1.85954 16.9793 1.8026 16.5986 1.77148C16.2073 1.73954 15.7006 1.73828 14.9561 1.73828H5.04297ZM14.7822 12.1738C15.2625 12.1738 15.6523 12.5637 15.6523 13.0439C15.6521 13.5239 15.2623 13.9131 14.7822 13.9131H5.2168C4.73692 13.9129 4.34795 13.5238 4.34766 13.0439C4.34766 12.5638 4.73674 12.174 5.2168 12.1738H14.7822ZM6.08691 7.82617C6.56708 7.82626 6.95605 8.2161 6.95605 8.69629V9.56543C6.95592 10.0455 6.567 10.4345 6.08691 10.4346H5.2168C4.73683 10.4344 4.3478 10.0454 4.34766 9.56543V8.69629C4.34766 8.21618 4.73674 7.82639 5.2168 7.82617H6.08691ZM10.4346 7.82617C10.9148 7.82618 11.3047 8.21605 11.3047 8.69629V9.56543C11.3045 10.0456 10.9147 10.4346 10.4346 10.4346H9.56543C9.08527 10.4346 8.69545 10.0456 8.69531 9.56543V8.69629C8.69531 8.21605 9.08519 7.82617 9.56543 7.82617H10.4346ZM14.7822 7.82617C15.2624 7.82627 15.6514 8.21611 15.6514 8.69629V9.56543C15.6512 10.0455 15.2623 10.4345 14.7822 10.4346H13.9121C13.4321 10.4344 13.0431 10.0454 13.043 9.56543V8.69629C13.043 8.21618 13.432 7.82638 13.9121 7.82617H14.7822ZM6.08691 3.47852C6.56695 3.4786 6.95583 3.86766 6.95605 4.34766V5.21777C6.95585 5.69779 6.56696 6.08683 6.08691 6.08691H5.2168C4.73687 6.08669 4.34787 5.6977 4.34766 5.21777V4.34766C4.34788 3.86774 4.73688 3.47874 5.2168 3.47852H6.08691ZM10.4346 3.47852C10.9147 3.47852 11.3045 3.86761 11.3047 4.34766V5.21777C11.3045 5.69784 10.9147 6.08691 10.4346 6.08691H9.56543C9.08532 6.08691 8.69552 5.69784 8.69531 5.21777V4.34766C8.69554 3.86761 9.08533 3.47852 9.56543 3.47852H10.4346ZM14.7822 3.47852C15.2622 3.47861 15.6511 3.86767 15.6514 4.34766V5.21777C15.6512 5.69778 15.2623 6.08682 14.7822 6.08691H13.9121C13.4322 6.0867 13.0432 5.69771 13.043 5.21777V4.34766C13.0432 3.86774 13.4322 3.47872 13.9121 3.47852H14.7822Z"}));function k(e){const{allowSpeech:r,setType:t}=e,a=d.useRef(null),i=d.useRef(0),[o,g]=d.useState(!1),p=d.useRef(!1),[s,v]=d.useState(!1),f=d.useCallback(async m=>{m.preventDefault(),await r?.onRecordStart?.();const h=m.touches[0];i.current=h.clientY,p.current=!1,v(!1),g(!0)},[r]),l=d.useCallback(m=>{if(m.preventDefault(),!o)return;const h=m.touches[0];i.current-h.clientY>50?p.current||(p.current=!0,v(!0)):p.current&&(p.current=!1,v(!1))},[o]),u=d.useCallback(async m=>{if(m.preventDefault(),!!o){try{await r?.onRecordEnd?.(!p.current)}catch(h){console.error(h)}g(!1),v(!1),p.current=!1,i.current=0}},[r,o]),c=d.useCallback(async m=>{m.preventDefault(),await r?.onRecordEnd?.(!1),g(!1),v(!1),p.current=!1,i.current=0},[r]);return d.useEffect(()=>{const m=a.current;if(m)return m.addEventListener("touchstart",f,{passive:!1}),m.addEventListener("touchmove",l,{passive:!1}),m.addEventListener("touchend",u,{passive:!1}),m.addEventListener("touchcancel",c,{passive:!1}),()=>{m.removeEventListener("touchstart",f),m.removeEventListener("touchmove",l),m.removeEventListener("touchend",u),m.removeEventListener("touchcancel",c)}},[f,l,u,c]),n.jsxs("div",{className:S("absolute inset-0 flex items-center justify-center rounded-xl",{"bg-red-500":s,"bg-primary":!s}),children:[o?n.jsxs(n.Fragment,{children:[n.jsx(V,{count:30,gap:4}),s&&n.jsx("div",{className:"absolute top-0 -mt-[2.5em] text-red08",children:"松开取消"}),!s&&n.jsx("div",{className:"absolute top-0 -mt-[2.5em] text-03",children:"松开发送，上移取消"})]}):n.jsx("div",{className:"text-base text-white",children:"按住说话"}),n.jsx("div",{className:"absolute inset-0",ref:a}),!o&&n.jsx(b,{type:"text",shape:"circle",icon:n.jsx(C,{component:he,className:"!text-xl text-white"}),onClick:()=>{t("input")},className:"absolute right-4"})]})}k.__docgenInfo={description:"",methods:[],displayName:"RecordAction",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""}}};function xe(e){const{value:r,onChange:t,placeholder:a,refText:i,autoFocus:o}=e;return n.jsx(L.TextArea,{ref:i,value:r?.text,autoFocus:o,onChange:g=>{t?.({...r,text:g.target.value})},placeholder:a,autoSize:{minRows:1,maxRows:3},className:"px-1 text-[15px]",variant:"borderless"})}function we(e){const{t:r}=j();return d.useMemo(()=>({...e,placeholder:e.placeholder??r("@fe-free/ai.sender.describeYourQuestion","描述你的问题"),defaultType:e.defaultType??"input"}),[e,r])}function Ce(e){const r=d.useRef(null),t=we(e),{statement:a,defaultType:i}=t,[o,g]=d.useState(i),p=d.useRef(null);return n.jsxs("div",{className:"fea-m-sender-wrap",children:[n.jsxs("div",{ref:p,className:S("fea-m-sender relative flex items-end rounded-xl border border-01 bg-white p-2.5"),children:[n.jsx("div",{className:"flex flex-1",children:n.jsx(xe,{...t,refText:r})}),n.jsx(I,{...t,refText:r,type:o,setType:g}),o==="record"&&n.jsx(k,{...t,setType:g})]}),a&&n.jsxs("div",{className:"mt-1 text-center text-xs text-04",children:["*",a]})]})}Ce.__docgenInfo={description:"",methods:[],displayName:"MSender",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""}}};var T=(e=>(e.SYSTEM="system",e))(T||{}),be=(e=>(e.PENDING="pending",e.STREAMING="streaming",e.DONE="done",e.ERROR="error",e))(be||{});function Te(e){const{messages:r,renderMessage:t,renderMessageOfSystem:a,renderMessageOfUser:i,renderMessageOfAI:o}=e,g=d.useRef(null),p=d.useMemo(()=>r?.[r.length-1],[r]);return d.useEffect(()=>{if(!p?.uuid)return;const s=document.querySelector(`[data-uuid="${p.uuid}"]`);s&&s.scrollIntoView({behavior:"smooth"})},[p?.uuid]),d.useEffect(()=>{if(!p?.updatedAt||!p?.uuid||!g.current)return;const s=document.querySelector(`[data-uuid="${p.uuid}"]`);if(!s)return;const{top:v,bottom:f}=g.current.getBoundingClientRect(),{top:l,bottom:u}=s.getBoundingClientRect();l<f&&u>v&&s.scrollIntoView({behavior:"smooth"})},[p?.updatedAt,p?.uuid]),n.jsx(D,{children:n.jsx("div",{ref:g,className:"flex h-full flex-col overflow-y-auto",children:r?.map(s=>n.jsx("div",{"data-uuid":s.uuid,className:"flex flex-col",children:t?t?.({message:s}):n.jsxs(n.Fragment,{children:[s.type===T.SYSTEM&&s.system&&n.jsx("div",{className:"flex justify-center",children:a?.({message:s})}),s.type!==T.SYSTEM&&s.user&&n.jsx("div",{className:"flex justify-end",children:i?.({message:s})}),s.type!==T.SYSTEM&&s.ai&&n.jsx("div",{className:"flex justify-start",children:o?.({message:s})})]})},s.uuid))})})}Te.__docgenInfo={description:"",methods:[],displayName:"Messages",props:{messages:{required:!1,tsType:{name:"Array",elements:[{name:"ChatMessage",elements:[{name:"AIData"}],raw:"ChatMessage<AIData>"}],raw:"ChatMessage<AIData>[]"},description:""},renderMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"AIData"}],raw:"ChatMessage<AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"含所有"},renderMessageOfSystem:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"AIData"}],raw:"ChatMessage<AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"系统消息"},renderMessageOfUser:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"AIData"}],raw:"ChatMessage<AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"用户消息"},renderMessageOfAI:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"AIData"}],raw:"ChatMessage<AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"AI消息"}}};const qe=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M17.3977 3.9588C15.8361 2.39727 13.3037 2.39727 11.7422 3.9588L5.03365 10.6673C2.60612 13.0952 2.60612 17.0314 5.03365 19.4592C7.46144 21.887 11.3983 21.8875 13.8262 19.4599L20.5348 12.7514C20.8472 12.439 21.3534 12.439 21.6658 12.7514C21.9781 13.0638 21.9782 13.5701 21.6658 13.8825L14.9573 20.591C11.9046 23.6435 6.95518 23.6429 3.90255 20.5903C0.850191 17.5377 0.850191 12.5889 3.90255 9.53624L10.6111 2.82771C12.7975 0.641334 16.3424 0.641334 18.5288 2.82771C20.7149 5.01409 20.7151 8.55906 18.5288 10.7454L11.8699 17.4042C10.5369 18.7372 8.37542 18.7365 7.04241 17.4035C5.70963 16.0705 5.7095 13.9096 7.04241 12.5767L13.7012 5.91785C14.0136 5.60547 14.5199 5.60557 14.8323 5.91785C15.1447 6.23027 15.1447 6.73652 14.8323 7.04894L8.1735 13.7078C7.46543 14.4159 7.46556 15.5642 8.1735 16.2724C8.88167 16.9806 10.03 16.9806 10.7381 16.2724L17.397 9.61358C18.9584 8.05211 18.959 5.52035 17.3977 3.9588Z",fill:"currentColor"}));function _(e){const{value:r,refUpload:t,fileUrls:a,setFileUrls:i,allowUpload:o}=e,{filesMaxCount:g}=o||{},{message:p}=E.useApp(),{t:s}=j(),[v,f]=d.useState(""),[l,u]=d.useState(!1);return n.jsxs(n.Fragment,{children:[n.jsx(ee,{trigger:["click"],placement:"topLeft",menu:{items:[{key:"add-file",label:s("@fe-free/ai.sender.addImageOrFile","添加图片或文件"),icon:n.jsx(C,{component:qe}),onClick:()=>{t.current?.click()}},{key:"add-file-url",label:s("@fe-free/ai.sender.addFileUrl","添加文件URL"),icon:n.jsx(C,{component:re}),onClick:()=>{f(""),u(!0)}}]},children:n.jsx(b,{shape:"circle",icon:n.jsx(C,{component:ne,className:"!text-lg"})})}),l&&n.jsx(te,{title:s("@fe-free/ai.sender.addFileUrl","添加文件URL"),open:!0,onCancel:()=>u(!1),onOk:()=>{if(g&&r?.files&&r.files.length>=g){p.warning(s("@fe-free/ai.sender.exceedMaxUploadCount","超过最大上传数量{count}",{count:g}));return}v.trim()&&i([...a,v]),u(!1)},children:n.jsx(L.TextArea,{placeholder:s("@fe-free/ai.sender.pleaseEnterFileUrl","请输入文件URL"),value:v,onChange:c=>f(c.target.value)})})]})}function H(e){const{allowUpload:r,refUpload:t,fileList:a,setFileList:i,uploadMaxCount:o}=e,{uploadAction:g,filesMaxCount:p}=r||{},{message:s}=E.useApp(),{t:v}=j();return n.jsx(X.Dragger,{action:g,fileList:a,multiple:!0,pastable:!0,maxCount:o?o+1:void 0,onChange:f=>{if(o&&f.fileList.length>o){s.warning(v("@fe-free/ai.sender.exceedMaxUploadCount","超过最大上传数量{count}",{count:p})),i(f.fileList.slice(-o));return}i(f.fileList)},children:n.jsx("div",{ref:t,children:v("@fe-free/ai.sender.dragFileHere","在此处拖放文件")})})}function Se({file:e,onDelete:r}){const t=U.isImage(e.name),a=e.response?.data?.url;return n.jsxs("div",{className:"group relative",children:[t?n.jsx(q,{url:URL.createObjectURL(e.originFileObj),isImage:t}):n.jsx(q,{url:e.name}),!a&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-01/80",children:[(e.percent??0).toFixed(0),"%"]}),n.jsx(F,{className:"absolute right-1 top-1 hidden cursor-pointer rounded-full bg-04 text-white group-hover:block",onClick:r})]})}function je({url:e,onDelete:r}){return n.jsxs("div",{className:"group relative",children:[n.jsx("div",{className:"flex h-[60px] w-[250px] items-center rounded bg-01 px-2",children:n.jsx("div",{className:"line-clamp-2",children:e})}),n.jsx(F,{className:"absolute right-1 top-1 hidden cursor-pointer rounded-full bg-04 text-white group-hover:block",onClick:r})]})}function O(e){const{fileList:r,setFileList:t,fileUrls:a,setFileUrls:i}=e;return n.jsx(n.Fragment,{children:(r&&r.length>0||a&&a.length>0)&&n.jsxs("div",{className:"scrollbar-hide mb-2 flex gap-2 overflow-x-auto",children:[r.map(o=>n.jsx(Se,{file:o,onDelete:()=>{t(r.filter(g=>g.uid!==o.uid))}},o.uid)),a.map(o=>n.jsx(je,{url:o,onDelete:()=>{i(a.filter(g=>g!==o))}},o))]})})}_.__docgenInfo={description:"",methods:[],displayName:"FileAction",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLDivElement"}],raw:"RefObject<HTMLDivElement>"},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};O.__docgenInfo={description:"",methods:[],displayName:"Files",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};H.__docgenInfo={description:"",methods:[],displayName:"FileUpload",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLDivElement"}],raw:"RefObject<HTMLDivElement>"},description:""},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},uploadMaxCount:{required:!1,tsType:{name:"number"},description:""}}};function Z(e){const{allowSpeech:r}=e,{recording:t,onRecordingChange:a}=r||{};return t?n.jsx(b,{type:"text",shape:"circle",onClick:()=>a?.(!1),children:n.jsx(V,{count:4,color:"primary"})}):n.jsx(b,{type:"text",shape:"circle",icon:n.jsx(ae,{className:"!text-lg"}),onClick:()=>a?.(!0)})}Z.__docgenInfo={description:"",methods:[],displayName:"RecordAction",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"}}};function Y(e){const{refText:r,loading:t,onSubmit:a,value:i,onChange:o,refUpload:g,isUploading:p,setFileList:s,fileUrls:v,setFileUrls:f,allowUpload:l,allowSpeech:u}=e,c=t||p,m=d.useCallback(async()=>{if(c||u?.recording)return;const h={...i,text:i?.text?.trim()};(h.text||h.files&&h.files.length>0)&&(await Promise.resolve(a?.(h)),s([]),f([]),o?.({}),r.current?.focus())},[c,u?.recording,i,a,s,f,o,r]);return n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex flex-1 gap-1",children:l&&n.jsx(_,{...e,refUpload:g,fileUrls:v,setFileUrls:f})}),n.jsx(ie,{type:"vertical"}),n.jsxs("div",{className:"flex items-center gap-2",children:[u&&n.jsx(Z,{...e}),n.jsx(b,{type:"primary",shape:"circle",icon:n.jsx(C,{component:P,className:"!text-lg"}),loading:c,onClick:m})]})]})}Y.__docgenInfo={description:"",methods:[],displayName:"Actions",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},refText:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLTextAreaElement"}],raw:"RefObject<HTMLTextAreaElement>"},description:""},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLDivElement"}],raw:"RefObject<HTMLDivElement>"},description:""},isUploading:{required:!0,tsType:{name:"boolean"},description:""},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};function Re(e){const{value:r,onChange:t,placeholder:a,refText:i}=e;return n.jsx(L.TextArea,{ref:i,value:r?.text,onChange:o=>{t?.({...r,text:o.target.value})},placeholder:a,autoSize:{minRows:2,maxRows:8},className:"mb-1 px-1 py-0",variant:"borderless"})}function Me(e){const{t:r}=j(),t=d.useMemo(()=>({placeholder:e.placeholder??r("@fe-free/ai.sender.describeYourQuestion","描述你的问题"),...e}),[e,r]),a=d.useRef(null),{value:i,onChange:o,allowUpload:g}=t,{filesMaxCount:p}=g||{},s=d.useRef(null),v=d.useRef(null),[f,l]=d.useState(!1);se(s,{onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},onDrop:()=>{l(!1)}});const[u,c]=d.useState([]),[m,h]=d.useState([]),w=d.useCallback(({fileUrls:x,fileList:$})=>{o?.({...i,files:[...$.map(z=>z.response?.data?.url)||[],...x]})},[i,o]),N=d.useCallback(x=>{c(x),w({fileUrls:x,fileList:m})},[m,w]),R=d.useCallback(x=>{h(x),w({fileUrls:u,fileList:x})},[u,w]),B=d.useMemo(()=>m.some(x=>!x.response?.data?.url),[m]);return n.jsxs("div",{className:"fea-sender-wrap",children:[n.jsxs("div",{ref:s,className:S("fea-sender relative flex flex-col rounded-xl border border-01 bg-white p-2",{"fea-sender-drag-hover":f}),children:[n.jsx(O,{...t,fileList:m,setFileList:R,fileUrls:u,setFileUrls:N}),n.jsx("div",{className:"flex",children:n.jsx(Re,{...t,refText:a})}),n.jsx(Y,{...t,refText:a,refUpload:v,isUploading:B,fileList:m,setFileList:R,fileUrls:u,setFileUrls:N}),n.jsx(H,{...t,refUpload:v,fileList:m,setFileList:R,uploadMaxCount:p?p-u.length:void 0})]}),n.jsx("div",{className:"mt-1 text-center text-xs text-03",children:r("@fe-free/ai.sender.aiGeneratedDisclaimer","内容由 AI 生成，无法确保信息的真实准确，仅供参考")})]})}Me.__docgenInfo={description:"",methods:[],displayName:"Sender",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"}}};export{oe as C,be as E,de as F,Ce as M,Me as S,T as a,Te as b,Ve as g};
