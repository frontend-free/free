import{r as d,A as w,j as o,lK as N,a as G,S as I,B as A,cU as U,cV as J,gp as K,gq as Y,dq as $,dr as H,lA as Q,lL as X,lz as Z,a8 as ee,lM as se}from"./iframe-BK1cNcxu.js";import{ax as b,ay as z,az as te,aA as ae,aB as oe,a as ne,M as re}from"./index-Bd_tv9HQ.js";import{g as ie}from"./index-D5mFeJj6.js";import{s as ce}from"./index-mAKpSMLY.js";import{b as ue}from"./_baseSet-CspmYppm.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-BO8_6Inb.js";import"./index-DrFu-skq.js";function T(e,a,t){return e==null?e:ue(e,a,t)}function le({value:e,onCopied:a,className:t}){const[n,r]=d.useState(!1),{message:i}=w.useApp(),c=d.useCallback(async()=>{r(!0),a?.(),i.success("复制成功")},[a,i]);return o.jsx(N,{title:"复制",children:o.jsx(G,{value:e,className:I("cursor-pointer text-03",t),onCopied:c,children:o.jsx(A,{type:"text",size:"small",className:"text-03",icon:n?o.jsx(U,{}):o.jsx(J,{})})})})}function de({active:e,onClick:a,className:t}){const{message:n}=w.useApp(),[r,i]=d.useState(e||!1);d.useEffect(()=>{i(!!e)},[e]);const c=d.useCallback(async()=>{await Promise.resolve(a?.(!r)),i(!r),n.success(r?"取消点赞成功":"点赞成功")},[a,r,n]);return o.jsx(N,{title:r?"取消点赞":"点赞",children:o.jsx(A,{type:"text",onClick:c,size:"small",className:I("text-03",t),icon:r?o.jsx(K,{}):o.jsx(Y,{})})})}function me({active:e,onClick:a,className:t}){const[n,r]=d.useState(e||!1),{message:i}=w.useApp();d.useEffect(()=>{r(!!e)},[e]);const c=d.useCallback(async()=>{await Promise.resolve(a?.(!n)),r(!n),i.success(n?"取消点踩成功":"点踩成功")},[a,n,i]);return o.jsx(N,{title:n?"取消点踩":"点踩",children:o.jsx(A,{type:"text",onClick:c,size:"small",className:I("text-03",t),icon:n?o.jsx($,{}):o.jsx(H,{})})})}const _={Copy:le,Like:de,Dislike:me},fe={},F=e=>{let a;const t=new Set,n=(l,h)=>{const f=typeof l=="function"?l(a):l;if(!Object.is(f,a)){const g=a;a=h??(typeof f!="object"||f===null)?f:Object.assign({},a,f),t.forEach(s=>s(a,g))}},r=()=>a,S={setState:n,getState:r,getInitialState:()=>m,subscribe:l=>(t.add(l),()=>t.delete(l)),destroy:()=>{(fe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},m=a=e(n,r,S);return S},pe=e=>e?F(e):F;var k={exports:{}},R={};var P;function ge(){if(P)return R;P=1;var e=Q(),a=X();function t(m,l){return m===l&&(m!==0||1/m===1/l)||m!==m&&l!==l}var n=typeof Object.is=="function"?Object.is:t,r=a.useSyncExternalStore,i=e.useRef,c=e.useEffect,p=e.useMemo,S=e.useDebugValue;return R.useSyncExternalStoreWithSelector=function(m,l,h,f,g){var s=i(null);if(s.current===null){var u={hasValue:!1,value:null};s.current=u}else u=s.current;s=p(function(){function j(x){if(!E){if(E=!0,C=x,x=f(x),g!==void 0&&u.hasValue){var y=u.value;if(g(y,x))return M=y}return M=x}if(y=M,n(C,x))return y;var V=f(x);return g!==void 0&&g(y,V)?(C=x,y):(C=x,M=V)}var E=!1,C,M,O=h===void 0?null:h;return[function(){return j(l())},O===null?void 0:function(){return j(O())}]},[l,h,f,g]);var v=r(m,s[0],s[1]);return c(function(){u.hasValue=!0,u.value=v},[v]),S(v),v},R}var W;function xe(){return W||(W=1,k.exports=ge()),k.exports}var he=xe();const Se=Z(he),L={},{useDebugValue:ve}=ee,{useSyncExternalStoreWithSelector:ye}=Se;let q=!1;const be=e=>e;function je(e,a=be,t){(L?"production":void 0)!=="production"&&t&&!q&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),q=!0);const n=ye(e.subscribe,e.getState,e.getServerState||e.getInitialState,a,t);return ve(n),n}const B=e=>{(L?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof e=="function"?pe(e):e,t=(n,r)=>je(a,n,r);return Object.assign(t,a),t},Ee=e=>e?B(e):B;function Ce(){const e=Ee((t,n,r)=>({senderValue:void 0,setSenderValue:i=>{t(()=>({senderValue:i}))},messages:[],setMessages:i=>{t(()=>({messages:i.map(c=>({createdAt:Date.now(),updatedAt:Date.now(),...c}))}))},addMessage:i=>{t(c=>({messages:[...c.messages,{...i,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:i=>{t(c=>({messages:c.messages.map(p=>p.uuid===i.uuid?{...i,updatedAt:Date.now()}:p)}))},contextData:void 0,setContextData:i=>{t(()=>({contextData:i}))},reset:()=>{t(r.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const t=e(r=>r.messages);return{chatStatus:d.useMemo(()=>t[t.length-1]?.status,[t])}}}}const Ve={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Me(e,{onUpdate:a}){await ce(1e3);let t=0;const n=setInterval(()=>{t>50?(clearInterval(n),a({event:"done",data:""})):(a({event:"message",data:"回复"+t}),t++)},300)}function De(){const{useChatStore:e,useChatStoreComputed:a}=d.useMemo(()=>Ce(),[]),t=e(s=>s.senderValue),n=e(s=>s.setSenderValue),r=e(s=>s.messages),i=e(s=>s.setMessages),c=e(s=>s.addMessage),p=e(s=>s.updateMessage),{chatStatus:S}=a(),{message:m}=w.useApp();d.useEffect(()=>{const s=localStorage.getItem("chatMessages");s&&i(JSON.parse(s))},[]);const l=S===b.PENDING||S===b.STREAMING,h=d.useCallback(s=>{console.log("onSubmit",s);const u={uuid:z(),status:b.PENDING,user:{...s}};c(u),Me(s,{onUpdate:({event:v,data:j})=>{if(v==="message"){u.status=b.STREAMING;const E=u.ai?.data?.text||"";T(u,"ai.data.text",E+j),T(u,"ai.session_id","123"),p(u)}v==="done"&&(u.status=b.DONE,p(u))}})},[c,p]),{start:f,stop:g}=d.useMemo(()=>ie(),[]);return o.jsxs("div",{children:[o.jsx("div",{children:o.jsx(A,{onClick:()=>{c({uuid:z(),type:te.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),o.jsx("div",{className:"h-[800px] w-[500px] max-w-full border border-red-500",children:o.jsx(ae,{end:o.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:o.jsx(re,{value:t,onChange:s=>n(s),loading:l,onSubmit:h,allowSpeech:{onRecordStart:async()=>{console.log("onRecordStart");try{await f({onAudio:s=>{console.log("onAudio",s)},onError:s=>{m.error(s.message)}})}catch(s){console.error(s)}},onRecordEnd:async s=>{console.log("onRecordEnd",s);const u=await g();console.log("voiceData",u)}}})}),children:o.jsx(oe,{messages:r,renderMessageOfSystem:({message:s})=>s.system?.data?.type==="new_session"?o.jsx(se,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:s})=>o.jsx("div",{className:"p-2",children:o.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:s.user?.text})}),renderMessageOfAI:({message:s})=>o.jsxs("div",{className:"max-w-full p-2",children:[o.jsxs("div",{children:["status: ",s.status," session_id: ",s.ai?.session_id]}),o.jsx(ne,{content:s.ai?.data?.text||""}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(_.Copy,{value:s.ai?.data?.text||""}),o.jsx(_.Like,{onClick:async()=>{}}),o.jsx(_.Dislike,{onClick:async()=>{}})]})]})})})})]})}const D={render:()=>o.jsx(De,{})};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...D.parameters?.docs?.source}}};const ze=["Default"];export{D as Default,ze as __namedExportsOrder,Ve as default};
