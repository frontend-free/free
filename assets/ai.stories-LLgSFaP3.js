import{lh as R,li as G,lj as L,lk as U,ll as $,r as g,lm as J,j as n,ln as A,C as K,B as M,cu as Y,cv as H,f$ as Q,g0 as X,c$ as Z,d0 as ee,l6 as se,lo as te,l8 as ae,a1 as ne,lp as re,lq as oe,lr as ie}from"./iframe-B2djbCm6.js";import{E as C,g as T,a as ue,C as ce,b as le,M as de}from"./index-72FiirOj.js";import{s as fe}from"./index-mAKpSMLY.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-B09JcLsj.js";function me(e,s,a,r){if(!R(e))return e;s=G(s,e);for(var o=-1,u=s.length,m=u-1,d=e;d!=null&&++o<u;){var f=L(s[o]),c=a;if(f==="__proto__"||f==="constructor"||f==="prototype")return e;if(o!=m){var i=d[f];c=void 0,c===void 0&&(c=R(i)?i:U(s[o+1])?[]:{})}$(d,f,c),d=d[f]}return e}function z(e,s,a){return e==null?e:me(e,s,a)}function pe({value:e,onCopied:s}){const[a,r]=g.useState(!1),{message:o}=J.useApp(),u=g.useCallback(async()=>{r(!0),s?.(),o.success("复制成功")},[s,o]);return n.jsx(A,{title:"复制",children:n.jsx(K,{value:e,className:"cursor-pointer text-03",onCopied:u,children:n.jsx(M,{type:"text",size:"small",className:"text-03",icon:a?n.jsx(Y,{}):n.jsx(H,{})})})})}function ge({onClick:e}){const[s,a]=g.useState(!1),r=g.useCallback(async()=>{await Promise.resolve(e?.(!s)),a(!s)},[e,s]);return n.jsx(A,{title:s?"取消点赞":"点赞",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:s?n.jsx(Q,{}):n.jsx(X,{})})})}function he({onClick:e}){const[s,a]=g.useState(!1),r=g.useCallback(async()=>{await Promise.resolve(e?.(!s)),a(!s)},[e,s]);return n.jsx(A,{title:s?"取消点踩":"点踩",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:s?n.jsx(Z,{}):n.jsx(ee,{})})})}const D={Copy:pe,Like:ge,Dislike:he},xe={},F=e=>{let s;const a=new Set,r=(i,x)=>{const t=typeof i=="function"?i(s):i;if(!Object.is(t,s)){const l=s;s=x??(typeof t!="object"||t===null)?t:Object.assign({},s,t),a.forEach(p=>p(s,l))}},o=()=>s,f={setState:r,getState:o,getInitialState:()=>c,subscribe:i=>(a.add(i),()=>a.delete(i)),destroy:()=>{(xe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),a.clear()}},c=s=e(r,o,f);return f},ve=e=>e?F(e):F;var _={exports:{}},w={};var P;function Se(){if(P)return w;P=1;var e=se(),s=te();function a(c,i){return c===i&&(c!==0||1/c===1/i)||c!==c&&i!==i}var r=typeof Object.is=="function"?Object.is:a,o=s.useSyncExternalStore,u=e.useRef,m=e.useEffect,d=e.useMemo,f=e.useDebugValue;return w.useSyncExternalStoreWithSelector=function(c,i,x,t,l){var p=u(null);if(p.current===null){var v={hasValue:!1,value:null};p.current=v}else v=p.current;p=d(function(){function I(h){if(!N){if(N=!0,b=h,h=t(h),l!==void 0&&v.hasValue){var y=v.value;if(l(y,h))return j=y}return j=h}if(y=j,r(b,h))return y;var k=t(h);return l!==void 0&&l(y,k)?(b=h,y):(b=h,j=k)}var N=!1,b,j,O=x===void 0?null:x;return[function(){return I(i())},O===null?void 0:function(){return I(O())}]},[i,x,t,l]);var S=o(c,p[0],p[1]);return m(function(){v.hasValue=!0,v.value=S},[S]),f(S),S},w}var V;function ye(){return V||(V=1,_.exports=Se()),_.exports}var Ce=ye();const be=ae(Ce),B={},{useDebugValue:je}=ne,{useSyncExternalStoreWithSelector:Ee}=be;let W=!1;const Me=e=>e;function De(e,s=Me,a){(B?"production":void 0)!=="production"&&a&&!W&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),W=!0);const r=Ee(e.subscribe,e.getState,e.getServerState||e.getInitialState,s,a);return je(r),r}const q=e=>{(B?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const s=typeof e=="function"?ve(e):e,a=(r,o)=>De(s,r,o);return Object.assign(a,s),a},_e=e=>e?q(e):q;function we(){const e=_e((a,r,o)=>({senderValue:void 0,setSenderValue:u=>{a(()=>({senderValue:u}))},messages:[],setMessages:u=>{a(()=>({messages:u.map(m=>({createdAt:Date.now(),updatedAt:Date.now(),...m}))}))},addMessage:u=>{a(m=>({messages:[...m.messages,{...u,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:u=>{a(m=>({messages:m.messages.map(d=>d.uuid===u.uuid?{...u,updatedAt:Date.now()}:d)}))},reset:()=>{a(o.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const a=e(o=>o.messages);return{chatStatus:g.useMemo(()=>a[a.length-1]?.status,[a])}}}}const ze={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Ae(e,{onUpdate:s}){await fe(1e3);let a=0;const r=setInterval(()=>{a>50?(clearInterval(r),s({event:"done",data:""})):(s({event:"message",data:"回复"+a}),a++)},300)}function Ie(){const{useChatStore:e,useChatStoreComputed:s}=g.useMemo(()=>we(),[]),a=e(t=>t.senderValue),r=e(t=>t.setSenderValue),o=e(t=>t.messages),u=e(t=>t.setMessages),m=e(t=>t.addMessage),d=e(t=>t.updateMessage),{chatStatus:f}=s(),c=re(o,{wait:500});g.useEffect(()=>{const t=localStorage.getItem("chatMessages");t&&u(JSON.parse(t))},[]),oe(()=>{localStorage.setItem("chatMessages",JSON.stringify(c))},[c]);const i=f===C.PENDING||f===C.STREAMING,x=g.useCallback(t=>{console.log("onSubmit",t);const l={uuid:T(),status:C.PENDING,user:{...t}};m(l),Ae(t,{onUpdate:({event:p,data:v})=>{if(p==="message"){l.status=C.STREAMING;const S=l.ai?.data?.text||"";z(l,"ai.data.text",S+v),z(l,"ai.session_id","123"),d(l)}p==="done"&&(l.status=C.DONE,d(l))}})},[]);return n.jsxs("div",{children:[n.jsx("div",{children:n.jsx(M,{onClick:()=>{m({uuid:T(),type:ue.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),n.jsx("div",{className:"h-[800px] w-[500px] border border-red-500",children:n.jsx(ce,{end:n.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:n.jsx(de,{value:a,onChange:t=>r(t),loading:i,onSubmit:x})}),children:n.jsx(le,{messages:o,renderMessageOfSystem:({message:t})=>t.system?.data?.type==="new_session"?n.jsx(ie,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:t})=>n.jsx("div",{className:"p-2",children:n.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:t.user?.text})}),renderMessageOfAI:({message:t})=>n.jsxs("div",{className:"p-2",children:[n.jsxs("div",{children:["status: ",t.status," session_id: ",t.ai?.session_id]}),n.jsx("pre",{className:"whitespace-pre-wrap",children:t.ai?.data?.text}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(D.Copy,{value:t.ai?.data?.text||""}),n.jsx(D.Like,{onClick:async()=>{}}),n.jsx(D.Dislike,{onClick:async()=>{}})]})]})})})})]})}const E={render:()=>n.jsx(Ie,{})};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...E.parameters?.docs?.source}}};const Fe=["Default"];export{E as Default,Fe as __namedExportsOrder,ze as default};
