import{qg as J,r as o,qh as X,qi as ee,j as n,H as _,F as M,qj as ne,qk as re,oT as S,e as te,B as T,bK as b,ql as D,qm as k,qn as ae,qo as ie,qp as se,ck as oe,A as H,qq as le,dV as O,qr as de,kC as ue,j4 as ce,qs as me,cr as pe}from"./iframe-CTBUehQA.js";var ge=function(e,r){r===void 0&&(r={});var t=J(r),a=o.useRef(void 0);X(function(){var i=ee(e);if(i?.addEventListener){var s=function(u,l){var p=u.getData("text/uri-list"),x=u.getData("custom");if(x&&t.current.onDom){var h=x;try{h=JSON.parse(x)}catch{h=x}t.current.onDom(h,l);return}if(p&&t.current.onUri){t.current.onUri(p,l);return}if(u.files&&u.files.length&&t.current.onFiles){t.current.onFiles(Array.from(u.files),l);return}u.items&&u.items.length&&t.current.onText&&u.items[0].getAsString(function(f){t.current.onText(f,l)})},d=function(u){var l,p;u.preventDefault(),u.stopPropagation(),a.current=u.target,(p=(l=t.current).onDragEnter)===null||p===void 0||p.call(l,u)},c=function(u){var l,p;u.preventDefault(),(p=(l=t.current).onDragOver)===null||p===void 0||p.call(l,u)},g=function(u){var l,p;u.target===a.current&&((p=(l=t.current).onDragLeave)===null||p===void 0||p.call(l,u))},m=function(u){var l,p;u.preventDefault(),s(u.dataTransfer,u),(p=(l=t.current).onDrop)===null||p===void 0||p.call(l,u)},v=function(u){var l,p;s(u.clipboardData,u),(p=(l=t.current).onPaste)===null||p===void 0||p.call(l,u)};return i.addEventListener("dragenter",d),i.addEventListener("dragover",c),i.addEventListener("dragleave",g),i.addEventListener("drop",m),i.addEventListener("paste",v),function(){i.removeEventListener("dragenter",d),i.removeEventListener("dragover",c),i.removeEventListener("dragleave",g),i.removeEventListener("drop",m),i.removeEventListener("paste",v)}}},[],e)};function fe({start:e,startClassName:r,end:t,endClassName:a,children:i,childrenClassName:s}){return n.jsx(_,{direction:"vertical",start:e,startClassName:r,end:t,endClassName:a,childrenClassName:s,children:i})}fe.__docgenInfo={description:"",methods:[],displayName:"Chat",props:{start:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},startClassName:{required:!1,tsType:{name:"string"},description:""},end:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},endClassName:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},childrenClassName:{required:!1,tsType:{name:"string"},description:""}}};function ve(e){return e.startsWith("http")||e.startsWith("https")}function L({url:e,isImage:r,size:t,className:a}){const i=r??M.isImage(e),s=ve(e)?decodeURIComponent(e):e,d=s.split("/").pop()||s;return n.jsx("div",{className:S("fea-file-view bg-01",a),children:i?n.jsx(ne,{width:60,height:60,src:e}):n.jsx("div",{className:"flex h-[60px] w-[250px] items-center rounded px-1",children:n.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[n.jsx(M.FileIcon,{name:d,className:"text-4xl"}),n.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[d&&n.jsx(re.Text,{ellipsis:{tooltip:d},children:d}),t&&n.jsx("div",{className:"text-sm text-03",children:M.getFileSize(t)})]})]})})})}function ye({urls:e}){return n.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(r=>n.jsx(L,{url:r},r))})}L.__docgenInfo={description:"",methods:[],displayName:"FileView",props:{url:{required:!0,tsType:{name:"string"},description:""},size:{required:!1,tsType:{name:"number"},description:""},isImage:{required:!1,tsType:{name:"boolean"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};ye.__docgenInfo={description:"",methods:[],displayName:"FileViewList",props:{urls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""}}};const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));function he(e,r=0){return(y[e[r+0]]+y[e[r+1]]+y[e[r+2]]+y[e[r+3]]+"-"+y[e[r+4]]+y[e[r+5]]+"-"+y[e[r+6]]+y[e[r+7]]+"-"+y[e[r+8]]+y[e[r+9]]+"-"+y[e[r+10]]+y[e[r+11]]+y[e[r+12]]+y[e[r+13]]+y[e[r+14]]+y[e[r+15]]).toLowerCase()}let V;const xe=new Uint8Array(16);function Ce(){if(!V){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");V=crypto.getRandomValues.bind(crypto)}return V(xe)}const we=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:we};function be(e,r,t){e=e||{};const a=e.random??e.rng?.()??Ce();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,he(a)}function Te(e,r,t){return I.randomUUID&&!e?I.randomUUID():be(e)}function qe(e){const r=[.1,.2,.4,.6,.8,.9];return r[e%r.length]}function E({count:e=4,gap:r=2,color:t="white"}){return n.jsx("div",{className:"flex h-0 gap-[2px]",style:{gap:`${r}px`},children:te(e).map(a=>n.jsx("div",{className:S({"bg-white":t==="white","bg-primary":t==="primary"}),style:{height:"4px",width:"2px",animation:`fea-sender-rectangle-${t} infinite 1s ease-in-out ${qe(a)}s`}},a))})}function He(){return Te()}E.__docgenInfo={description:"",methods:[],displayName:"RecordLoading",props:{count:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"4",computed:!1}},height:{required:!1,tsType:{name:"number"},description:""},width:{required:!1,tsType:{name:"number"},description:""},gap:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"2",computed:!1}},color:{required:!1,tsType:{name:"union",raw:"'white' | 'primary'",elements:[{name:"literal",value:"'white'"},{name:"literal",value:"'primary'"}]},description:"",defaultValue:{value:"'white'",computed:!1}}}};const Se=e=>o.createElement("svg",{width:14,height:18,viewBox:"0 0 14 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},o.createElement("path",{d:"M1.46387 8.41895C1.46399 11.2488 3.75802 13.5429 6.58789 13.543C9.41782 13.543 11.7118 11.2488 11.7119 8.41895H13.1758C13.1757 11.8102 10.6136 14.6009 7.31934 14.9648V17.2031H5.85547V14.9648C2.56181 14.6004 0.000112876 11.8097 0 8.41895H1.46387ZM6.58789 0C8.60932 0 10.248 1.63873 10.248 3.66016V8.41797C10.248 10.4394 8.60932 12.0781 6.58789 12.0781C4.56664 12.0779 2.92773 10.4393 2.92773 8.41797V3.66016C2.92775 1.63887 4.56665 0.000220666 6.58789 0Z"})),Z=e=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"size-18 text-dbx-static-white",...e},o.createElement("path",{d:"M10.6254 20.3752V6.69549L5.47304 11.8478C4.93607 12.3848 4.0647 12.3848 3.52773 11.8478C2.99076 11.3109 2.99076 10.4395 3.52773 9.90252L11.0277 2.40252L11.1322 2.30877C11.6723 1.86801 12.4695 1.89901 12.973 2.40252L20.473 9.90252L20.5668 10.007C21.0075 10.5471 20.9766 11.3443 20.473 11.8478C19.9695 12.3513 19.1723 12.3823 18.6322 11.9416L18.5277 11.8478L13.3754 6.69549V20.3752C13.3754 21.1346 12.7598 21.7502 12.0004 21.7502C11.241 21.7502 10.6254 21.1346 10.6254 20.3752Z",fill:"currentColor"}));function B(e){const{loading:r,onSubmit:t,value:a,onChange:i,setType:s,allowSpeech:d}=e,c=r,g=o.useCallback(async()=>{if(c||a?.text?.trim()==="")return;const m={...a,text:a?.text?.trim()};(m.text||m.files&&m.files.length>0)&&(await Promise.resolve(t?.(m)),i?.({}))},[c,a,t,i]);return n.jsx("div",{className:"mr-1 flex items-center gap-2",children:d&&!a?.text?n.jsx(T,{type:"primary",shape:"circle",icon:n.jsx(b,{component:Se,className:"h-[28px]! text-lg!"}),onClick:()=>{s("record")}}):n.jsx(T,{type:"primary",shape:"circle",icon:n.jsx(b,{component:Z,className:"h-[28px]! text-lg!"}),loading:c,onClick:g})})}B.__docgenInfo={description:"",methods:[],displayName:"Actions",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""},refText:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"TextAreaRef | null",elements:[{name:"TextAreaRef"},{name:"null"}]}],raw:"RefObject<TextAreaRef | null>"},description:""},type:{required:!0,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},setType:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: 'input' | 'record') => void",signature:{arguments:[{type:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},name:"type"}],return:{name:"void"}}},description:""}}};const je=e=>o.createElement("svg",{width:20,height:18,viewBox:"0 0 20 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},o.createElement("path",{d:"M14.9561 0C15.6719 -6.75109e-08 16.2617 -0.000981836 16.7402 0.0380859C17.2288 0.0780087 17.6787 0.164078 18.1006 0.378906C18.7546 0.712247 19.2867 1.24447 19.6201 1.89844C19.8351 2.32031 19.921 2.77023 19.9609 3.25879C20 3.7373 19.999 4.32705 19.999 5.04297V12.3477C19.999 13.0634 20 13.6534 19.9609 14.1318C19.921 14.6203 19.8349 15.0694 19.6201 15.4912C19.2867 16.1456 18.7549 16.6782 18.1006 17.0117C17.6786 17.2267 17.2289 17.3126 16.7402 17.3525C16.2617 17.3916 15.672 17.3906 14.9561 17.3906H5.04297C4.32702 17.3906 3.73732 17.3916 3.25879 17.3525C2.77019 17.3126 2.32034 17.2267 1.89844 17.0117C1.24428 16.6782 0.712259 16.1455 0.378906 15.4912C0.1642 15.0695 0.078011 14.6202 0.0380859 14.1318C-0.000970309 13.6534 -2.36304e-07 13.0634 0 12.3477V5.04297C-4.75188e-07 4.32705 -0.00100976 3.7373 0.0380859 3.25879C0.0780378 2.7702 0.163945 2.32032 0.378906 1.89844C0.712319 1.24436 1.24435 0.712298 1.89844 0.378906C2.32035 0.163931 2.77017 0.0780345 3.25879 0.0380859C3.73732 -0.00101134 4.32702 -3.93286e-07 5.04297 0H14.9561ZM5.04297 1.73828C4.29836 1.73828 3.79169 1.73951 3.40039 1.77148C3.01944 1.80264 2.82442 1.85944 2.68848 1.92871C2.36139 2.09541 2.09543 2.3614 1.92871 2.68848C1.85945 2.82441 1.80264 3.0195 1.77148 3.40039C1.73951 3.79168 1.73828 4.29841 1.73828 5.04297V12.3477C1.73828 13.092 1.73955 13.599 1.77148 13.9902C1.8026 14.3707 1.85956 14.5662 1.92871 14.7021C2.09537 15.0291 2.36157 15.2952 2.68848 15.4619C2.82441 15.5312 3.01958 15.588 3.40039 15.6191C3.79169 15.6511 4.29836 15.6514 5.04297 15.6514H14.9561C15.7006 15.6514 16.2073 15.6511 16.5986 15.6191C16.9796 15.588 17.1746 15.5312 17.3105 15.4619C17.6377 15.2952 17.9036 15.0293 18.0703 14.7021C18.1395 14.5662 18.1964 14.371 18.2275 13.9902C18.2595 13.599 18.2607 13.092 18.2607 12.3477V5.04297C18.2607 4.29841 18.2595 3.79168 18.2275 3.40039C18.1964 3.01955 18.1396 2.82441 18.0703 2.68848C17.9036 2.36151 17.6376 2.09536 17.3105 1.92871C17.1746 1.85954 16.9793 1.8026 16.5986 1.77148C16.2073 1.73954 15.7006 1.73828 14.9561 1.73828H5.04297ZM14.7822 12.1738C15.2625 12.1738 15.6523 12.5637 15.6523 13.0439C15.6521 13.5239 15.2623 13.9131 14.7822 13.9131H5.2168C4.73692 13.9129 4.34795 13.5238 4.34766 13.0439C4.34766 12.5638 4.73674 12.174 5.2168 12.1738H14.7822ZM6.08691 7.82617C6.56708 7.82626 6.95605 8.2161 6.95605 8.69629V9.56543C6.95592 10.0455 6.567 10.4345 6.08691 10.4346H5.2168C4.73683 10.4344 4.3478 10.0454 4.34766 9.56543V8.69629C4.34766 8.21618 4.73674 7.82639 5.2168 7.82617H6.08691ZM10.4346 7.82617C10.9148 7.82618 11.3047 8.21605 11.3047 8.69629V9.56543C11.3045 10.0456 10.9147 10.4346 10.4346 10.4346H9.56543C9.08527 10.4346 8.69545 10.0456 8.69531 9.56543V8.69629C8.69531 8.21605 9.08519 7.82617 9.56543 7.82617H10.4346ZM14.7822 7.82617C15.2624 7.82627 15.6514 8.21611 15.6514 8.69629V9.56543C15.6512 10.0455 15.2623 10.4345 14.7822 10.4346H13.9121C13.4321 10.4344 13.0431 10.0454 13.043 9.56543V8.69629C13.043 8.21618 13.432 7.82638 13.9121 7.82617H14.7822ZM6.08691 3.47852C6.56695 3.4786 6.95583 3.86766 6.95605 4.34766V5.21777C6.95585 5.69779 6.56696 6.08683 6.08691 6.08691H5.2168C4.73687 6.08669 4.34787 5.6977 4.34766 5.21777V4.34766C4.34788 3.86774 4.73688 3.47874 5.2168 3.47852H6.08691ZM10.4346 3.47852C10.9147 3.47852 11.3045 3.86761 11.3047 4.34766V5.21777C11.3045 5.69784 10.9147 6.08691 10.4346 6.08691H9.56543C9.08532 6.08691 8.69552 5.69784 8.69531 5.21777V4.34766C8.69554 3.86761 9.08533 3.47852 9.56543 3.47852H10.4346ZM14.7822 3.47852C15.2622 3.47861 15.6511 3.86767 15.6514 4.34766V5.21777C15.6512 5.69778 15.2623 6.08682 14.7822 6.08691H13.9121C13.4322 6.0867 13.0432 5.69771 13.043 5.21777V4.34766C13.0432 3.86774 13.4322 3.47872 13.9121 3.47852H14.7822Z"}));function Y(e){const{allowSpeech:r,setType:t,refText:a,loading:i}=e,s=o.useRef(null),d=o.useRef(0),[c,g]=o.useState(!1),m=o.useRef(!1),[v,u]=o.useState(!1),l=o.useCallback(async f=>{if(f.preventDefault(),i)return;await r?.onRecordStart?.();const C=f.touches[0];d.current=C.clientY,m.current=!1,u(!1),g(!0)},[r,i]),p=o.useCallback(f=>{if(f.preventDefault(),!c)return;const C=f.touches[0];d.current-C.clientY>50?m.current||(m.current=!0,u(!0)):m.current&&(m.current=!1,u(!1))},[c]),x=o.useCallback(async f=>{if(f.preventDefault(),!!c){try{await r?.onRecordEnd?.(!m.current)}catch(C){console.error(C)}g(!1),u(!1),m.current=!1,d.current=0}},[r,c]),h=o.useCallback(async f=>{f.preventDefault(),await r?.onRecordEnd?.(!1),g(!1),u(!1),m.current=!1,d.current=0},[r]);return o.useEffect(()=>{const f=s.current;if(f)return f.addEventListener("touchstart",l,{passive:!1}),f.addEventListener("touchmove",p,{passive:!1}),f.addEventListener("touchend",x,{passive:!1}),f.addEventListener("touchcancel",h,{passive:!1}),()=>{f.removeEventListener("touchstart",l),f.removeEventListener("touchmove",p),f.removeEventListener("touchend",x),f.removeEventListener("touchcancel",h)}},[l,p,x,h]),n.jsxs("div",{className:S("fea-m-sender-record absolute inset-0 flex items-center justify-center rounded-xl",{"bg-red-500":v,"bg-primary":!v}),children:[c?n.jsxs(n.Fragment,{children:[n.jsx(E,{count:30,gap:4}),n.jsxs("div",{className:"text-03 absolute top-0 right-0 left-0 -mt-[50px] flex h-[50px] items-end justify-center bg-white pb-2",children:[v&&n.jsx("div",{className:"text-red08",children:"松开取消"}),!v&&n.jsx("div",{className:"text-03",children:"松开发送  上移取消"})]})]}):n.jsx("div",{className:"text-base text-white",children:"按住说话"}),n.jsx("div",{className:"absolute inset-0",ref:s}),!c&&n.jsx(T,{type:"text",shape:"circle",icon:n.jsx(b,{component:je,className:"h-[28px]! text-xl! text-white!"}),onClick:()=>{t("input"),a.current?.focus()},className:"absolute! right-4!"})]})}Y.__docgenInfo={description:"",methods:[],displayName:"RecordAction",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""},refText:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"TextAreaRef | null",elements:[{name:"TextAreaRef"},{name:"null"}]}],raw:"RefObject<TextAreaRef | null>"},description:""}}};function Re(e){const{value:r,onChange:t,placeholder:a,refText:i,autoFocus:s}=e;return n.jsx(k.TextArea,{ref:i,value:r?.text,autoFocus:s,onChange:d=>{t?.({...r,text:d.target.value})},placeholder:a,autoSize:{minRows:1,maxRows:3},className:"px-1 text-[15px]",variant:"borderless"})}function Ue(e){const{t:r}=D();return o.useMemo(()=>({...e,placeholder:e.placeholder??r("@fe-free/ai.sender.describeYourQuestion","描述你的问题"),defaultType:e.defaultType??"input"}),[e,r])}function Me(e){const r=o.useRef(null),t=Ue(e),{statement:a,defaultType:i}=t,[s,d]=o.useState(i),c=o.useRef(null);return n.jsxs("div",{className:"fea-m-sender-wrap",children:[n.jsxs("div",{ref:c,className:S("fea-m-sender border-01 relative flex items-end rounded-xl border bg-white p-2.5"),style:{boxShadow:"0px 2px 12px 0px #00000014"},children:[n.jsx("div",{className:"flex flex-1",children:n.jsx(Re,{...t,refText:r})}),n.jsx(B,{...t,refText:r,type:s,setType:d}),s==="record"&&n.jsx(Y,{...t,refText:r,setType:d})]}),a&&n.jsxs("div",{className:"text-04 mt-1 text-center text-xs",children:["*",a]})]})}Me.__docgenInfo={description:"",methods:[],displayName:"MSender",props:{value:{required:!1,tsType:{name:"MSenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: MSenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"MSenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},autoFocus:{required:!1,tsType:{name:"boolean"},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 录音开始时回调，如果没权限，则 reject */
  onRecordStart?: () => Promise<void>;
  /** 录音结束时回调, isSend 为 true 则发送，否则取消 */
  onRecordEnd?: (isSend: boolean) => Promise<void>;
}`,signature:{properties:[{key:"onRecordStart",value:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音开始时回调，如果没权限，则 reject"},{key:"onRecordEnd",value:{name:"signature",type:"function",raw:"(isSend: boolean) => Promise<void>",signature:{arguments:[{type:{name:"boolean"},name:"isSend"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!1},description:"录音结束时回调, isSend 为 true 则发送，否则取消"}]}},description:"是否允许语音输入"},defaultType:{required:!1,tsType:{name:"union",raw:"'input' | 'record'",elements:[{name:"literal",value:"'input'"},{name:"literal",value:"'record'"}]},description:""},statement:{required:!1,tsType:{name:"string"},description:""}}};const Ne=e=>o.createElement("svg",{width:12,height:12,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},o.createElement("path",{d:"M9.80022 0.000346623C10.3956 -0.0083669 10.97 0.146298 11.3912 0.566726C11.8123 0.987879 11.9677 1.56297 11.9583 2.1584C11.9496 2.75164 11.7782 3.41387 11.4935 4.09352C11.2145 4.7429 10.8741 5.36414 10.477 5.94878C10.9214 6.60592 11.2793 7.25436 11.5349 7.86575C11.8196 8.54541 11.9902 9.20764 11.9997 9.80088C12.0084 10.3963 11.853 10.9707 11.4326 11.3911C11.0114 11.8123 10.4363 11.9684 9.84088 11.9589C9.24763 11.9502 8.58613 11.7789 7.90575 11.4942C7.29726 11.2401 6.65318 10.8843 5.99894 10.4428C5.34543 10.8843 4.70135 11.2401 4.09286 11.4942C3.4132 11.7789 2.75097 11.9502 2.15773 11.9589C1.5623 11.9684 0.987938 11.8123 0.566784 11.3918C0.14563 10.9707 -0.00903481 10.3963 0.000404838 9.80088C0.00911836 9.20691 0.179032 8.54541 0.463674 7.86575C0.719271 7.25436 1.0758 6.60592 1.52019 5.94878C1.12348 5.36412 0.783555 4.74287 0.505063 4.09352C0.220421 3.41387 0.0505076 2.75164 0.041068 2.1584C0.0323545 1.56297 0.186293 0.988605 0.607447 0.567452C1.0286 0.146298 1.60369 -0.00836689 2.19912 0.00107276C2.79236 0.00978629 3.45387 0.1797 4.13425 0.464342C4.72967 0.713403 5.35922 1.05831 5.99894 1.486C6.63866 1.05759 7.26966 0.713403 7.86509 0.464342C8.54474 0.1797 9.20624 0.00978628 9.80022 0.000346623ZM2.20638 6.89057C1.9225 7.33469 1.67575 7.80148 1.46863 8.28618C1.21667 8.88887 1.09468 9.40805 1.08814 9.81686C1.08233 10.2235 1.18835 10.4733 1.33648 10.6214C1.48533 10.7695 1.73585 10.8756 2.14175 10.8697C2.55056 10.8639 3.06974 10.7419 3.67243 10.49C4.15456 10.2835 4.61891 10.0377 5.06078 9.75514C4.53958 9.34105 4.04257 8.89738 3.57222 8.42632C3.0712 7.9253 2.61374 7.40829 2.20638 6.89057ZM9.7915 6.89057C8.95508 7.9533 7.99736 8.91467 6.93782 9.75514C7.4207 10.0601 7.88905 10.307 8.32618 10.49C8.92886 10.7419 9.44877 10.8639 9.85758 10.8697C10.2642 10.8763 10.514 10.7703 10.6621 10.6214C10.8103 10.4733 10.9163 10.2235 10.9105 9.81686C10.9039 9.40805 10.7819 8.88814 10.53 8.28618C10.3226 7.80147 10.0756 7.33468 9.7915 6.89057ZM5.99894 2.82208C5.39911 3.27502 4.83182 3.76951 4.30126 4.30192C3.78316 4.81841 3.30086 5.36961 2.85772 5.95168C3.31201 6.55419 3.80822 7.12392 4.34264 7.65663C4.86105 8.1765 5.41444 8.66026 5.99894 9.10453C6.5508 8.687 7.10992 8.20268 7.65596 7.65663C8.18989 7.12387 8.68561 6.55414 9.13944 5.95168C8.69678 5.36964 8.21497 4.81845 7.69735 4.30192C7.13824 3.74281 6.56459 3.24686 5.99894 2.82208ZM2.18242 1.08881C1.77579 1.083 1.526 1.18902 1.37787 1.33715C1.22974 1.486 1.12372 1.73579 1.12953 2.14242C1.13607 2.55123 1.25806 3.07041 1.51002 3.6731C1.68647 4.09498 1.92174 4.54445 2.21074 5.00917C2.62264 4.4922 3.06362 3.99909 3.53156 3.53223C4.01281 3.05013 4.52198 2.59673 5.05643 2.17437C4.5888 1.88319 4.13715 1.64648 3.71309 1.4693C3.11041 1.21734 2.59123 1.09535 2.18242 1.08881ZM9.81619 1.08881C9.40738 1.09607 8.88748 1.21734 8.28552 1.4693C7.86146 1.64648 7.40908 1.88319 6.94218 2.17365C7.47661 2.59602 7.98578 3.04942 8.46705 3.5315C8.93477 3.99886 9.37552 4.49245 9.78715 5.0099C10.0761 4.54518 10.3136 4.0957 10.49 3.67382C10.742 3.07114 10.864 2.55196 10.8698 2.14315C10.8763 1.73652 10.7703 1.48673 10.6215 1.33787C10.4733 1.18974 10.2235 1.08373 9.81692 1.08954L9.81619 1.08881Z"}));function Le({title:e,icon:r,loading:t,children:a,expanded:i,onClick:s,className:d}){const[c,g]=o.useState(i||!1);o.useEffect(()=>{g(i||!1)},[i]),o.useEffect(()=>{i===void 0&&t!==void 0&&g(!!t)},[i,t]);const m=o.useCallback(()=>{g(!c),s?.()},[c,s]);return n.jsx(ae,{title:e,icon:r||n.jsx(b,{component:Ne,className:"!text-sm"}),loading:t,blink:t,expanded:c,onClick:m,className:S("fea-message-think",d),children:a})}Le.__docgenInfo={description:"",methods:[],displayName:"MessageThink",props:{title:{required:!0,tsType:{name:"string"},description:""},icon:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};var N=(e=>(e.SYSTEM="system",e))(N||{}),De=(e=>(e.PENDING="pending",e.STREAMING="streaming",e.DONE="done",e.ERROR="error",e))(De||{});function Ae({ref:e}){const[r,t]=o.useState(!1);return o.useEffect(()=>{const a=()=>{if(!e.current)return;const{scrollTop:i,clientHeight:s,scrollHeight:d}=e.current,c=d>s&&i+s+200<=d;t(c)};return e.current&&e.current.addEventListener("scroll",a),a(),()=>{e.current?.removeEventListener("scroll",a)}},[e]),r}function Ve(e){const{refList:r,messages:t,renderMessage:a,renderMessageOfSystem:i,renderMessageOfUser:s,renderMessageOfAI:d}=e,c=o.useRef(null),g=r||c,m=o.useMemo(()=>t?.[t.length-1],[t]),v=ie(()=>{m?.uuid&&setTimeout(()=>{const l=document.querySelector(`[data-uuid="${m.uuid}"]`);l&&l.scrollIntoView({behavior:"smooth",block:"end"})},100)});o.useEffect(()=>{m?.uuid&&v()},[v,m?.uuid]),o.useEffect(()=>{!m?.updatedAt||!m?.uuid||!g.current||setTimeout(()=>{const l=document.querySelector(`[data-uuid="${m.uuid}"]`);if(!l)return;const{top:p,bottom:x}=g.current.getBoundingClientRect(),{top:h,bottom:f}=l.getBoundingClientRect();h<x&&f>p&&v()},100)},[m?.updatedAt,m?.uuid,g,v]);const u=Ae({ref:g});return n.jsx(_,{children:n.jsxs(se,{refScroll:g,className:"fea-messages-scroll relative flex h-full flex-col overflow-x-hidden overflow-y-auto",style:{transform:"translateZ(0)"},children:[t?.map(l=>n.jsx("div",{"data-uuid":l.uuid,className:"flex flex-col",children:a?a?.({message:l}):n.jsxs(n.Fragment,{children:[l.type===N.SYSTEM&&l.system&&n.jsx("div",{className:"flex justify-center",children:i?.({message:l})}),l.type!==N.SYSTEM&&l.user&&n.jsx("div",{className:"flex justify-end",children:s?.({message:l})}),l.type!==N.SYSTEM&&l.ai&&n.jsx("div",{className:"flex justify-start",children:d?.({message:l})})]})},l.uuid)),n.jsx("div",{className:"pointer-events-none sticky bottom-2 mx-auto flex justify-center",children:n.jsx(T,{shape:"circle",icon:n.jsx(oe,{}),onClick:()=>{v()},className:"pointer-events-auto! bg-white! text-2xl! shadow-[0px_1px_12px_0px_#2921391F]!",style:{transform:`translateY(${u?0:30}px) scale(${u?1:0})`,width:44,height:44}})})]})})}Ve.__docgenInfo={description:"",methods:[],displayName:"Messages",props:{refList:{required:!1,tsType:{name:"ReactRefObject",raw:"React.RefObject<HTMLDivElement | null>",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}]},description:""},messages:{required:!1,tsType:{name:"Array",elements:[{name:"ChatMessage",elements:[{name:"UserData"},{name:"AIData"}],raw:"ChatMessage<UserData, AIData>"}],raw:"ChatMessage<UserData, AIData>[]"},description:""},renderMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<UserData, AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<UserData, AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"UserData"},{name:"AIData"}],raw:"ChatMessage<UserData, AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"含所有"},renderMessageOfSystem:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<UserData, AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<UserData, AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"UserData"},{name:"AIData"}],raw:"ChatMessage<UserData, AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"系统消息"},renderMessageOfUser:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<UserData, AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<UserData, AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"UserData"},{name:"AIData"}],raw:"ChatMessage<UserData, AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"用户消息"},renderMessageOfAI:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: { message: ChatMessage<UserData, AIData> }) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ message: ChatMessage<UserData, AIData> }",signature:{properties:[{key:"message",value:{name:"ChatMessage",elements:[{name:"UserData"},{name:"AIData"}],raw:"ChatMessage<UserData, AIData>",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:"AI消息"}}};const ke=e=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},o.createElement("path",{d:"M17.3977 3.9588C15.8361 2.39727 13.3037 2.39727 11.7422 3.9588L5.03365 10.6673C2.60612 13.0952 2.60612 17.0314 5.03365 19.4592C7.46144 21.887 11.3983 21.8875 13.8262 19.4599L20.5348 12.7514C20.8472 12.439 21.3534 12.439 21.6658 12.7514C21.9781 13.0638 21.9782 13.5701 21.6658 13.8825L14.9573 20.591C11.9046 23.6435 6.95518 23.6429 3.90255 20.5903C0.850191 17.5377 0.850191 12.5889 3.90255 9.53624L10.6111 2.82771C12.7975 0.641334 16.3424 0.641334 18.5288 2.82771C20.7149 5.01409 20.7151 8.55906 18.5288 10.7454L11.8699 17.4042C10.5369 18.7372 8.37542 18.7365 7.04241 17.4035C5.70963 16.0705 5.7095 13.9096 7.04241 12.5767L13.7012 5.91785C14.0136 5.60547 14.5199 5.60557 14.8323 5.91785C15.1447 6.23027 15.1447 6.73652 14.8323 7.04894L8.1735 13.7078C7.46543 14.4159 7.46556 15.5642 8.1735 16.2724C8.88167 16.9806 10.03 16.9806 10.7381 16.2724L17.397 9.61358C18.9584 8.05211 18.959 5.52035 17.3977 3.9588Z",fill:"currentColor"}));function $(e){const{value:r,refUpload:t,fileUrls:a,setFileUrls:i,allowUpload:s}=e,{filesMaxCount:d}=s||{},{message:c}=H.useApp(),{t:g}=D(),[m,v]=o.useState(""),[u,l]=o.useState(!1);return n.jsxs(n.Fragment,{children:[n.jsx(de,{trigger:["click"],placement:"topLeft",menu:{items:[{key:"add-file",label:g("@fe-free/ai.sender.addImageOrFile","添加图片或文件"),icon:n.jsx(b,{component:ke}),onClick:()=>{t.current?.click()}},{key:"add-file-url",label:g("@fe-free/ai.sender.addFileUrl","添加文件URL"),icon:n.jsx(b,{component:ce}),onClick:()=>{v(""),l(!0)}}]},children:n.jsx(T,{shape:"circle",icon:n.jsx(b,{component:ue,className:"!text-lg"})})}),u&&n.jsx(me,{title:g("@fe-free/ai.sender.addFileUrl","添加文件URL"),open:!0,onCancel:()=>l(!1),onOk:()=>{if(d&&r?.files&&r.files.length>=d){c.warning(g("@fe-free/ai.sender.exceedMaxUploadCount","超过最大上传数量{count}",{count:d}));return}m.trim()&&i([...a,m]),l(!1)},children:n.jsx(k.TextArea,{placeholder:g("@fe-free/ai.sender.pleaseEnterFileUrl","请输入文件URL"),value:m,onChange:p=>v(p.target.value)})})]})}function K(e){const{allowUpload:r,refUpload:t,fileList:a,setFileList:i,uploadMaxCount:s}=e,{uploadAction:d,filesMaxCount:c}=r||{},{message:g}=H.useApp(),{t:m}=D();return n.jsx(le.Dragger,{action:d,fileList:a,multiple:!0,pastable:!0,maxCount:s?s+1:void 0,onChange:v=>{if(s&&v.fileList.length>s){g.warning(m("@fe-free/ai.sender.exceedMaxUploadCount","超过最大上传数量{count}",{count:c})),i(v.fileList.slice(-s));return}i(v.fileList)},children:n.jsx("div",{ref:t,children:m("@fe-free/ai.sender.dragFileHere","在此处拖放文件")})})}function Ee({file:e,onDelete:r}){const t=M.isImage(e.name),a=e.response?.data?.url;return n.jsxs("div",{className:"group relative",children:[t?n.jsx(L,{url:URL.createObjectURL(e.originFileObj),isImage:t}):n.jsx(L,{url:e.name}),!a&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-01/80",children:[(e.percent??0).toFixed(0),"%"]}),n.jsx(O,{className:"absolute right-1 top-1 hidden cursor-pointer rounded-full bg-04 text-white group-hover:block",onClick:r})]})}function Fe({url:e,onDelete:r}){return n.jsxs("div",{className:"group relative",children:[n.jsx("div",{className:"flex h-[60px] w-[250px] items-center rounded bg-01 px-2",children:n.jsx("div",{className:"line-clamp-2",children:e})}),n.jsx(O,{className:"absolute right-1 top-1 hidden cursor-pointer rounded-full bg-04 text-white group-hover:block",onClick:r})]})}function z(e){const{fileList:r,setFileList:t,fileUrls:a,setFileUrls:i}=e;return n.jsx(n.Fragment,{children:(r&&r.length>0||a&&a.length>0)&&n.jsxs("div",{className:"scrollbar-hide mb-2 flex gap-2 overflow-x-auto",children:[r.map(s=>n.jsx(Ee,{file:s,onDelete:()=>{t(r.filter(d=>d.uid!==s.uid))}},s.uid)),a.map(s=>n.jsx(Fe,{url:s,onDelete:()=>{i(a.filter(d=>d!==s))}},s))]})})}$.__docgenInfo={description:"",methods:[],displayName:"FileAction",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}],raw:"RefObject<HTMLDivElement | null>"},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};z.__docgenInfo={description:"",methods:[],displayName:"Files",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};K.__docgenInfo={description:"",methods:[],displayName:"FileUpload",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}],raw:"RefObject<HTMLDivElement | null>"},description:""},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},uploadMaxCount:{required:!1,tsType:{name:"number"},description:""}}};function W(e){const{allowSpeech:r}=e,{recording:t,onRecordingChange:a}=r||{};return t?n.jsx(T,{type:"text",shape:"circle",onClick:()=>a?.(!1),children:n.jsx(E,{count:4,color:"primary"})}):n.jsx(T,{type:"text",shape:"circle",icon:n.jsx(pe,{className:"text-lg!"}),onClick:()=>a?.(!0)})}W.__docgenInfo={description:"",methods:[],displayName:"RecordAction",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""}}};function G(e){const{refUpload:r,isUploading:t,fileUrls:a,setFileUrls:i,allowUpload:s,allowSpeech:d,loading:c,onSubmit:g}=e,m=c||t;return n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex flex-1 gap-1",children:s&&n.jsx($,{...e,refUpload:r,fileUrls:a,setFileUrls:i})}),n.jsxs("div",{className:"flex items-center gap-2",children:[d&&n.jsx(W,{...e}),n.jsx(T,{type:"primary",shape:"circle",icon:n.jsx(b,{component:Z,className:"h-[28px]! text-lg!"}),loading:m,onClick:g})]})]})}G.__docgenInfo={description:"",methods:[],displayName:"Actions",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""},refText:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"TextAreaRef | null",elements:[{name:"TextAreaRef"},{name:"null"}]}],raw:"RefObject<TextAreaRef | null>"},description:""},refUpload:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}],raw:"RefObject<HTMLDivElement | null>"},description:""},isUploading:{required:!0,tsType:{name:"boolean"},description:""},fileList:{required:!0,tsType:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},description:""},setFileList:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileList: UploadFile[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"UploadFile"}],raw:"UploadFile[]"},name:"fileList"}],return:{name:"void"}}},description:""},fileUrls:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},setFileUrls:{required:!0,tsType:{name:"signature",type:"function",raw:"(fileUrls: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"fileUrls"}],return:{name:"void"}}},description:""}}};function Pe(e){const{value:r,onChange:t,placeholder:a,refText:i,onSubmit:s}=e,d=o.useCallback(c=>{c.key==="Enter"&&c.shiftKey||c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s?.())},[s]);return n.jsx(k.TextArea,{ref:i,value:r?.text,onChange:c=>{t?.({...r,text:c.target.value})},onKeyDown:d,placeholder:a,autoSize:{minRows:2,maxRows:8},className:"mb-1 px-1 py-0",variant:"borderless"})}function Ie(e){const{t:r}=D(),t=o.useMemo(()=>({placeholder:e.placeholder??r("@fe-free/ai.sender.describeYourQuestion","描述你的问题， shift + enter 换行"),...e}),[e,r]),a=o.useRef(null),{value:i,onChange:s,allowUpload:d,onSubmit:c,loading:g,allowSpeech:m}=t,{filesMaxCount:v}=d||{},u=o.useRef(null),l=o.useRef(null),[p,x]=o.useState(!1);ge(d?u:null,{onDragEnter:()=>{x(!0)},onDragLeave:()=>{x(!1)},onDrop:()=>{x(!1)}});const[h,f]=o.useState([]),[C,F]=o.useState([]),R=o.useCallback(({fileUrls:w,fileList:q})=>{s?.({...i,files:[...q.map(Q=>Q.response?.data?.url)||[],...w]})},[i,s]),U=o.useCallback(w=>{f(w),R({fileUrls:w,fileList:C})},[C,R]),j=o.useCallback(w=>{F(w),R({fileUrls:h,fileList:w})},[h,R]),A=o.useMemo(()=>C.some(w=>!w.response?.data?.url),[C]),P=o.useCallback(async()=>{if(g||A||m?.recording)return;const q={...i,text:i?.text?.trim()};(q.text||q.files&&q.files.length>0)&&(await Promise.resolve(c?.(q)),j([]),U([]),s?.({}),a.current?.focus())},[g,A,m?.recording,i,c,j,U,s]);return n.jsxs("div",{className:"fea-sender-wrap",children:[n.jsxs("div",{ref:u,className:S("fea-sender border-01 relative flex flex-col rounded-xl border bg-white p-2",{"fea-sender-drag-hover":p}),style:{boxShadow:"0px 2px 12px 0px #00000014"},children:[n.jsx(z,{...t,fileList:C,setFileList:j,fileUrls:h,setFileUrls:U}),n.jsx("div",{className:"flex",children:n.jsx(Pe,{...t,refText:a,onSubmit:P})}),n.jsx(G,{...t,refText:a,refUpload:l,isUploading:A,fileList:C,setFileList:j,fileUrls:h,setFileUrls:U,onSubmit:P}),d&&n.jsx(K,{...t,refUpload:l,fileList:C,setFileList:j,uploadMaxCount:v?v-h.length:void 0})]}),t.statement&&n.jsx("div",{className:"text-03 mt-1 text-center text-xs",children:t.statement})]})}Ie.__docgenInfo={description:"",methods:[],displayName:"Sender",props:{value:{required:!1,tsType:{name:"SenderValue"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"void"}}},description:""},loading:{required:!1,tsType:{name:"boolean"},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(value?: SenderValue) => void | Promise<void>",signature:{arguments:[{type:{name:"SenderValue"},name:"value"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},allowUpload:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 上传文件的接口地址，约定返回的 {data: {url: string}} */
  uploadAction?: string;
  /** files 最大数量 */
  filesMaxCount?: number;
}`,signature:{properties:[{key:"uploadAction",value:{name:"string",required:!1},description:"上传文件的接口地址，约定返回的 {data: {url: string}}"},{key:"filesMaxCount",value:{name:"number",required:!1},description:"files 最大数量"}]}},description:""},allowSpeech:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 是否正在录音 */
  recording?: boolean;
  /** 录音状态变化时回调 */
  onRecordingChange?: (recording: boolean) => void;
}`,signature:{properties:[{key:"recording",value:{name:"boolean",required:!1},description:"是否正在录音"},{key:"onRecordingChange",value:{name:"signature",type:"function",raw:"(recording: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"recording"}],return:{name:"void"}},required:!1},description:"录音状态变化时回调"}]}},description:"是否允许语音输入"},statement:{required:!1,tsType:{name:"string"},description:""}}};export{fe as C,De as E,ye as F,Me as M,Ie as S,Le as a,N as b,Ve as c,He as g};
