import{lh as k,li as G,lj as q,lk as B,ll as L,r as g,lm as U,j as a,ln as I,C as $,B as _,cu as J,cv as K,f$ as H,g0 as Q,c$ as X,d0 as Y,l6 as Z,lo as ee,l8 as te,a1 as se,lp as re,lq as ae}from"./iframe-CiuVke3y.js";import{g as ne,C as oe,a as ie,M as ue}from"./index-dWFX9Dpi.js";import{s as ce}from"./index-mAKpSMLY.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-DEvN_V9G.js";function le(e,t,s,n){if(!k(e))return e;t=G(t,e);for(var o=-1,u=t.length,p=u-1,d=e;d!=null&&++o<u;){var f=q(t[o]),c=s;if(f==="__proto__"||f==="constructor"||f==="prototype")return e;if(o!=p){var i=d[f];c=void 0,c===void 0&&(c=k(i)?i:B(t[o+1])?[]:{})}L(d,f,c),d=d[f]}return e}function de(e,t,s){return e==null?e:le(e,t,s)}function fe({value:e,onCopied:t}){const[s,n]=g.useState(!1),{message:o}=U.useApp(),u=g.useCallback(async()=>{n(!0),t?.(),o.success("复制成功")},[t,o]);return a.jsx(I,{title:"复制",children:a.jsx($,{value:e,className:"cursor-pointer text-03",onCopied:u,children:a.jsx(_,{type:"text",size:"small",className:"text-03",icon:s?a.jsx(J,{}):a.jsx(K,{})})})})}function me({onClick:e}){const[t,s]=g.useState(!1),n=g.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return a.jsx(I,{title:t?"取消点赞":"点赞",children:a.jsx(_,{type:"text",onClick:n,size:"small",className:"text-03",icon:t?a.jsx(H,{}):a.jsx(Q,{})})})}function pe({onClick:e}){const[t,s]=g.useState(!1),n=g.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return a.jsx(I,{title:t?"取消点踩":"点踩",children:a.jsx(_,{type:"text",onClick:n,size:"small",className:"text-03",icon:t?a.jsx(X,{}):a.jsx(Y,{})})})}const M={Copy:fe,Like:me,Dislike:pe},ge={},z=e=>{let t;const s=new Set,n=(i,x)=>{const r=typeof i=="function"?i(t):i;if(!Object.is(r,t)){const l=t;t=x??(typeof r!="object"||r===null)?r:Object.assign({},t,r),s.forEach(m=>m(t,l))}},o=()=>t,f={setState:n,getState:o,getInitialState:()=>c,subscribe:i=>(s.add(i),()=>s.delete(i)),destroy:()=>{(ge?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=t=e(n,o,f);return f},ve=e=>e?z(e):z;var D={exports:{}},N={};var P;function xe(){if(P)return N;P=1;var e=Z(),t=ee();function s(c,i){return c===i&&(c!==0||1/c===1/i)||c!==c&&i!==i}var n=typeof Object.is=="function"?Object.is:s,o=t.useSyncExternalStore,u=e.useRef,p=e.useEffect,d=e.useMemo,f=e.useDebugValue;return N.useSyncExternalStoreWithSelector=function(c,i,x,r,l){var m=u(null);if(m.current===null){var h={hasValue:!1,value:null};m.current=h}else h=m.current;m=d(function(){function O(v){if(!A){if(A=!0,C=v,v=r(v),l!==void 0&&h.hasValue){var b=h.value;if(l(b,v))return E=b}return E=v}if(b=E,n(C,v))return b;var R=r(v);return l!==void 0&&l(b,R)?(C=v,b):(C=v,E=R)}var A=!1,C,E,w=x===void 0?null:x;return[function(){return O(i())},w===null?void 0:function(){return O(w())}]},[i,x,r,l]);var S=o(c,m[0],m[1]);return p(function(){h.hasValue=!0,h.value=S},[S]),f(S),S},N}var T;function he(){return T||(T=1,D.exports=xe()),D.exports}var Se=he();const be=te(Se),W={},{useDebugValue:je}=se,{useSyncExternalStoreWithSelector:Ce}=be;let F=!1;const Ee=e=>e;function ye(e,t=Ee,s){(W?"production":void 0)!=="production"&&s&&!F&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),F=!0);const n=Ce(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return je(n),n}const V=e=>{(W?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?ve(e):e,s=(n,o)=>ye(t,n,o);return Object.assign(s,t),s},Me=e=>e?V(e):V;function De(){const e=Me((s,n,o)=>({senderValue:void 0,setSenderValue:u=>{s(()=>({senderValue:u}))},messages:[],setMessages:u=>{s(()=>({messages:u}))},addMessage:u=>{s(p=>({messages:[...p.messages,{...u,updatedAt:Date.now()}]}))},updateMessage:u=>{s(p=>({messages:p.messages.map(d=>d.uuid===u.uuid?{...u,updatedAt:Date.now()}:d)}))},reset:()=>{s(o.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const s=e(o=>o.messages);return{chatStatus:g.useMemo(()=>s[s.length-1]?.status,[s])}}}}var j=(e=>(e.PENDING="pending",e.STREAMING="streaming",e.DONE="done",e.ERROR="error",e))(j||{});const ke={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Ne(e,{onUpdate:t}){await ce(1e3);let s=0;const n=setInterval(()=>{s>50?(clearInterval(n),t({event:"done",data:""})):(t({event:"message",data:"回复"+s}),s++)},300)}function Ie(){const{useChatStore:e,useChatStoreComputed:t}=g.useMemo(()=>De(),[]),s=e(r=>r.senderValue),n=e(r=>r.setSenderValue),o=e(r=>r.messages),u=e(r=>r.setMessages),p=e(r=>r.addMessage),d=e(r=>r.updateMessage),{chatStatus:f}=t(),c=re(o,{wait:500});g.useEffect(()=>{const r=localStorage.getItem("chatMessages");r&&u(JSON.parse(r))},[]),ae(()=>{localStorage.setItem("chatMessages",JSON.stringify(c))},[c]);const i=f===j.PENDING||f===j.STREAMING,x=g.useCallback(r=>{console.log("onSubmit",r);const l={uuid:ne(),status:j.PENDING,user:{...r}};p(l),Ne(r,{onUpdate:({event:m,data:h})=>{if(m==="message"){l.status=j.STREAMING;const S=l.ai?.data?.text||"";de(l,"ai.data.text",S+h),d({...l})}m==="done"&&(l.status=j.DONE,d({...l}))}})},[]);return a.jsx("div",{className:"h-[800px] w-[500px] border border-red-500",children:a.jsx(oe,{end:a.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:a.jsx(ue,{value:s,onChange:r=>n(r),loading:i,onSubmit:x})}),children:a.jsx(ie,{messages:o,renderMessageOfUser:({message:r})=>a.jsx("div",{className:"p-2",children:a.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:r.user?.text})}),renderMessageOfAI:({message:r})=>a.jsxs("div",{className:"p-2",children:[a.jsx("div",{children:r.status}),a.jsx("pre",{className:"whitespace-pre-wrap",children:r.ai?.data?.text}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(M.Copy,{value:r.ai?.data?.text||""}),a.jsx(M.Like,{onClick:async()=>{}}),a.jsx(M.Dislike,{onClick:async()=>{}})]})]})})})})}const y={render:()=>a.jsx(Ie,{})};y.parameters={...y.parameters,docs:{...y.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...y.parameters?.docs?.source}}};const ze=["Default"];export{y as Default,ze as __namedExportsOrder,ke as default};
