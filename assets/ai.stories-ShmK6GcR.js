import{r as f,lJ as L,j as n,lK as A,a as q,B as M,cT as G,cU as U,go as J,gp as K,dp as Y,dq as $,lz as H,lL as Q,ly as X,a7 as Z,lM as ee}from"./iframe-BxNbYdDl.js";import{ax as y,ay as R,az as te,aA as se,aB as ae,M as ne}from"./index-Dv2Zg2WW.js";import{s as re}from"./index-mAKpSMLY.js";import{b as oe}from"./_baseSet-D73A2IAZ.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-CqD6FtS4.js";import"./index-DrFu-skq.js";function T(e,t,s){return e==null?e:oe(e,t,s)}function ie({value:e,onCopied:t}){const[s,r]=f.useState(!1),{message:c}=L.useApp(),i=f.useCallback(async()=>{r(!0),t?.(),c.success("复制成功")},[t,c]);return n.jsx(A,{title:"复制",children:n.jsx(q,{value:e,className:"cursor-pointer text-03",onCopied:i,children:n.jsx(M,{type:"text",size:"small",className:"text-03",icon:s?n.jsx(G,{}):n.jsx(U,{})})})})}function ue({onClick:e}){const[t,s]=f.useState(!1),r=f.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return n.jsx(A,{title:t?"取消点赞":"点赞",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:t?n.jsx(J,{}):n.jsx(K,{})})})}function ce({onClick:e}){const[t,s]=f.useState(!1),r=f.useCallback(async()=>{await Promise.resolve(e?.(!t)),s(!t)},[e,t]);return n.jsx(A,{title:t?"取消点踩":"点踩",children:n.jsx(M,{type:"text",onClick:r,size:"small",className:"text-03",icon:t?n.jsx(Y,{}):n.jsx($,{})})})}const D={Copy:ie,Like:ue,Dislike:ce},le={},V=e=>{let t;const s=new Set,r=(u,a)=>{const o=typeof u=="function"?u(t):u;if(!Object.is(o,t)){const m=t;t=a??(typeof o!="object"||o===null)?o:Object.assign({},t,o),s.forEach(p=>p(t,m))}},c=()=>t,v={setState:r,getState:c,getInitialState:()=>d,subscribe:u=>(s.add(u),()=>s.delete(u)),destroy:()=>{(le?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},d=t=e(r,c,v);return v},de=e=>e?V(e):V;var w={exports:{}},_={};var z;function me(){if(z)return _;z=1;var e=H(),t=Q();function s(d,u){return d===u&&(d!==0||1/d===1/u)||d!==d&&u!==u}var r=typeof Object.is=="function"?Object.is:s,c=t.useSyncExternalStore,i=e.useRef,l=e.useEffect,g=e.useMemo,v=e.useDebugValue;return _.useSyncExternalStoreWithSelector=function(d,u,a,o,m){var p=i(null);if(p.current===null){var h={hasValue:!1,value:null};p.current=h}else h=p.current;p=g(function(){function k(x){if(!N){if(N=!0,j=x,x=o(x),m!==void 0&&h.hasValue){var S=h.value;if(m(S,x))return C=S}return C=x}if(S=C,r(j,x))return S;var O=o(x);return m!==void 0&&m(S,O)?(j=x,S):(j=x,C=O)}var N=!1,j,C,I=a===void 0?null:a;return[function(){return k(u())},I===null?void 0:function(){return k(I())}]},[u,a,o,m]);var b=c(d,p[0],p[1]);return l(function(){h.hasValue=!0,h.value=b},[b]),v(b),b},_}var F;function pe(){return F||(F=1,w.exports=me()),w.exports}var fe=pe();const ge=X(fe),B={},{useDebugValue:xe}=Z,{useSyncExternalStoreWithSelector:he}=ge;let W=!1;const ve=e=>e;function Se(e,t=ve,s){(B?"production":void 0)!=="production"&&s&&!W&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),W=!0);const r=he(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return xe(r),r}const P=e=>{(B?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?de(e):e,s=(r,c)=>Se(t,r,c);return Object.assign(s,t),s},ye=e=>e?P(e):P;function be(){const e=ye((s,r,c)=>({senderValue:void 0,setSenderValue:i=>{s(()=>({senderValue:i}))},messages:[],setMessages:i=>{s(()=>({messages:i.map(l=>({createdAt:Date.now(),updatedAt:Date.now(),...l}))}))},addMessage:i=>{s(l=>({messages:[...l.messages,{...i,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:i=>{s(l=>({messages:l.messages.map(g=>g.uuid===i.uuid?{...i,updatedAt:Date.now()}:g)}))},contextData:void 0,setContextData:i=>{s(()=>({contextData:i}))},reset:()=>{s(c.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const s=e(c=>c.messages);return{chatStatus:f.useMemo(()=>s[s.length-1]?.status,[s])}}}}const Ne={title:"@fe-free/ai/Example",tags:["autodocs"]};async function je(e,{onUpdate:t}){await re(1e3);let s=0;const r=setInterval(()=>{s>50?(clearInterval(r),t({event:"done",data:""})):(t({event:"message",data:"回复"+s}),s++)},300)}function Ce(){const{useChatStore:e,useChatStoreComputed:t}=f.useMemo(()=>be(),[]),s=e(a=>a.senderValue),r=e(a=>a.setSenderValue),c=e(a=>a.messages),i=e(a=>a.setMessages),l=e(a=>a.addMessage),g=e(a=>a.updateMessage),{chatStatus:v}=t();f.useEffect(()=>{const a=localStorage.getItem("chatMessages");a&&i(JSON.parse(a))},[]);const d=v===y.PENDING||v===y.STREAMING,u=f.useCallback(a=>{console.log("onSubmit",a);const o={uuid:R(),status:y.PENDING,user:{...a}};l(o),je(a,{onUpdate:({event:m,data:p})=>{if(m==="message"){o.status=y.STREAMING;const h=o.ai?.data?.text||"";T(o,"ai.data.text",h+p),T(o,"ai.session_id","123"),g(o)}m==="done"&&(o.status=y.DONE,g(o))}})},[l,g]);return n.jsxs("div",{children:[n.jsx("div",{children:n.jsx(M,{onClick:()=>{l({uuid:R(),type:te.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),n.jsx("div",{className:"h-[800px] w-[500px] border border-red-500",children:n.jsx(se,{end:n.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:n.jsx(ne,{value:s,onChange:a=>r(a),loading:d,onSubmit:u})}),children:n.jsx(ae,{messages:c,renderMessageOfSystem:({message:a})=>a.system?.data?.type==="new_session"?n.jsx(ee,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:a})=>n.jsx("div",{className:"p-2",children:n.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:a.user?.text})}),renderMessageOfAI:({message:a})=>n.jsxs("div",{className:"p-2",children:[n.jsxs("div",{children:["status: ",a.status," session_id: ",a.ai?.session_id]}),n.jsx("pre",{className:"whitespace-pre-wrap",children:a.ai?.data?.text}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(D.Copy,{value:a.ai?.data?.text||""}),n.jsx(D.Like,{onClick:async()=>{}}),n.jsx(D.Dislike,{onClick:async()=>{}})]})]})})})})]})}const E={render:()=>n.jsx(Ce,{})};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...E.parameters?.docs?.source}}};const Ie=["Default"];export{E as Default,Ie as __namedExportsOrder,Ne as default};
