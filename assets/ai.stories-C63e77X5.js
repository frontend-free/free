import{r as d,lJ as k,j as n,lK as A,a as q,B as M,cT as G,cU as U,go as J,gp as K,dp as Y,dq as $,lz as H,lL as Q,ly as X,a7 as Z,lM as ee}from"./iframe-DgQ-aEXn.js";import{ax as y,ay as T,az as te,aA as se,aB as ae,a as ne,M as re}from"./index-D-l36iHo.js";import{s as oe}from"./index-mAKpSMLY.js";import{b as ie}from"./_baseSet-CvAWwWt9.js";import"./preload-helper-PPVm8Dsz.js";import"./Icon-DiXEdOk9.js";import"./index-DrFu-skq.js";function V(e,a,t){return e==null?e:ie(e,a,t)}function ue({value:e,onCopied:a}){const[t,r]=d.useState(!1),{message:o}=k.useApp(),i=d.useCallback(async()=>{r(!0),a?.(),o.success("复制成功")},[a,o]);return n.jsx(A,{title:"复制",children:n.jsx(q,{value:e,className:"cursor-pointer text-03",onCopied:i,children:n.jsx(M,{type:"text",size:"small",className:"text-03",icon:t?n.jsx(G,{}):n.jsx(U,{})})})})}function ce({active:e,onClick:a}){const{message:t}=k.useApp(),[r,o]=d.useState(e||!1);d.useEffect(()=>{o(!!e)},[e]);const i=d.useCallback(async()=>{await Promise.resolve(a?.(!r)),o(!r),t.success(r?"取消点赞成功":"点赞成功")},[a,r,t]);return n.jsx(A,{title:r?"取消点赞":"点赞",children:n.jsx(M,{type:"text",onClick:i,size:"small",className:"text-03",icon:r?n.jsx(J,{}):n.jsx(K,{})})})}function le({active:e,onClick:a}){const[t,r]=d.useState(e||!1),{message:o}=k.useApp();d.useEffect(()=>{r(!!e)},[e]);const i=d.useCallback(async()=>{await Promise.resolve(a?.(!t)),r(!t),o.success(t?"取消点踩成功":"点踩成功")},[a,t,o]);return n.jsx(A,{title:t?"取消点踩":"点踩",children:n.jsx(M,{type:"text",onClick:i,size:"small",className:"text-03",icon:t?n.jsx(Y,{}):n.jsx($,{})})})}const D={Copy:ue,Like:ce,Dislike:le},de={},z=e=>{let a;const t=new Set,r=(c,s)=>{const u=typeof c=="function"?c(a):c;if(!Object.is(u,a)){const f=a;a=s??(typeof u!="object"||u===null)?u:Object.assign({},a,u),t.forEach(p=>p(a,f))}},o=()=>a,v={setState:r,getState:o,getInitialState:()=>m,subscribe:c=>(t.add(c),()=>t.delete(c)),destroy:()=>{(de?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},m=a=e(r,o,v);return v},me=e=>e?z(e):z;var w={exports:{}},_={};var F;function fe(){if(F)return _;F=1;var e=H(),a=Q();function t(m,c){return m===c&&(m!==0||1/m===1/c)||m!==m&&c!==c}var r=typeof Object.is=="function"?Object.is:t,o=a.useSyncExternalStore,i=e.useRef,l=e.useEffect,g=e.useMemo,v=e.useDebugValue;return _.useSyncExternalStoreWithSelector=function(m,c,s,u,f){var p=i(null);if(p.current===null){var h={hasValue:!1,value:null};p.current=h}else h=p.current;p=g(function(){function N(x){if(!I){if(I=!0,j=x,x=u(x),f!==void 0&&h.hasValue){var S=h.value;if(f(S,x))return C=S}return C=x}if(S=C,r(j,x))return S;var R=u(x);return f!==void 0&&f(S,R)?(j=x,S):(j=x,C=R)}var I=!1,j,C,O=s===void 0?null:s;return[function(){return N(c())},O===null?void 0:function(){return N(O())}]},[c,s,u,f]);var b=o(m,p[0],p[1]);return l(function(){h.hasValue=!0,h.value=b},[b]),v(b),b},_}var W;function pe(){return W||(W=1,w.exports=fe()),w.exports}var ge=pe();const xe=X(ge),L={},{useDebugValue:he}=Z,{useSyncExternalStoreWithSelector:ve}=xe;let P=!1;const Se=e=>e;function ye(e,a=Se,t){(L?"production":void 0)!=="production"&&t&&!P&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),P=!0);const r=ve(e.subscribe,e.getState,e.getServerState||e.getInitialState,a,t);return he(r),r}const B=e=>{(L?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof e=="function"?me(e):e,t=(r,o)=>ye(a,r,o);return Object.assign(t,a),t},be=e=>e?B(e):B;function je(){const e=be((t,r,o)=>({senderValue:void 0,setSenderValue:i=>{t(()=>({senderValue:i}))},messages:[],setMessages:i=>{t(()=>({messages:i.map(l=>({createdAt:Date.now(),updatedAt:Date.now(),...l}))}))},addMessage:i=>{t(l=>({messages:[...l.messages,{...i,createdAt:Date.now(),updatedAt:Date.now()}]}))},updateMessage:i=>{t(l=>({messages:l.messages.map(g=>g.uuid===i.uuid?{...i,updatedAt:Date.now()}:g)}))},contextData:void 0,setContextData:i=>{t(()=>({contextData:i}))},reset:()=>{t(o.getInitialState())}}));return{useChatStore:e,useChatStoreComputed:()=>{const t=e(o=>o.messages);return{chatStatus:d.useMemo(()=>t[t.length-1]?.status,[t])}}}}const Ie={title:"@fe-free/ai/Example",tags:["autodocs"]};async function Ce(e,{onUpdate:a}){await oe(1e3);let t=0;const r=setInterval(()=>{t>50?(clearInterval(r),a({event:"done",data:""})):(a({event:"message",data:"回复"+t}),t++)},300)}function Ee(){const{useChatStore:e,useChatStoreComputed:a}=d.useMemo(()=>je(),[]),t=e(s=>s.senderValue),r=e(s=>s.setSenderValue),o=e(s=>s.messages),i=e(s=>s.setMessages),l=e(s=>s.addMessage),g=e(s=>s.updateMessage),{chatStatus:v}=a();d.useEffect(()=>{const s=localStorage.getItem("chatMessages");s&&i(JSON.parse(s))},[]);const m=v===y.PENDING||v===y.STREAMING,c=d.useCallback(s=>{console.log("onSubmit",s);const u={uuid:T(),status:y.PENDING,user:{...s}};l(u),Ce(s,{onUpdate:({event:f,data:p})=>{if(f==="message"){u.status=y.STREAMING;const h=u.ai?.data?.text||"";V(u,"ai.data.text",h+p),V(u,"ai.session_id","123"),g(u)}f==="done"&&(u.status=y.DONE,g(u))}})},[l,g]);return n.jsxs("div",{children:[n.jsx("div",{children:n.jsx(M,{onClick:()=>{l({uuid:T(),type:te.SYSTEM,system:{data:{type:"new_session"}}})},children:"Add New Session"})}),n.jsx("div",{className:"h-[800px] w-[500px] max-w-full border border-red-500",children:n.jsx(se,{end:n.jsx("div",{className:"p-2",onFocus:()=>{console.log("onFocus")},onBlur:()=>{console.log("onBlur")},children:n.jsx(re,{value:t,onChange:s=>r(s),loading:m,onSubmit:c})}),children:n.jsx(ae,{messages:o,renderMessageOfSystem:({message:s})=>s.system?.data?.type==="new_session"?n.jsx(ee,{children:"让我们聊点新内容吧"}):null,renderMessageOfUser:({message:s})=>n.jsx("div",{className:"p-2",children:n.jsx("div",{className:"rounded-xl bg-primary p-2 text-white",children:s.user?.text})}),renderMessageOfAI:({message:s})=>n.jsxs("div",{className:"max-w-full p-2",children:[n.jsxs("div",{children:["status: ",s.status," session_id: ",s.ai?.session_id]}),n.jsx(ne,{content:s.ai?.data?.text||""}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(D.Copy,{value:s.ai?.data?.text||""}),n.jsx(D.Like,{onClick:async()=>{}}),n.jsx(D.Dislike,{onClick:async()=>{}})]})]})})})})]})}const E={render:()=>n.jsx(Ee,{})};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: () => {
    return <Component />;
  }
}`,...E.parameters?.docs?.source}}};const Oe=["Default"];export{E as Default,Oe as __namedExportsOrder,Ie as default};
